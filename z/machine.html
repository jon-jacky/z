<html>

<head>
<link rel="stylesheet" href="zed.css" type="text/css">
<title>Radiation therapy machine</title>
</head>

<body>

<h2><a name="top">Radiation Therapy Machine<a></h2>

<p>
Here is the <a href="rationale.html">rationale</a> for this Z specification.
</p>

<p>
This page shows excerpts from the 
<a href="rt-machine.pdf">full report</a>.
</p>

<p>
Links to other pages, reports, and papers about this
<a href="../cnts/">
radiation therapy machine</a>.
</p>

<p>
Created from this
<a href="machine.txt">LaTeX source</a> with the 
<a href="z2html/z2html.html"><b>Z2HTML</b> translator</a>.
</p>

<p>
Links to more <a href="z-examples.html">Z examples</a>.
</p>


<p class="informal">
This page looks best when this <var class="zed"><img height=11 width=9 alt="\power" src="zimg/power-m.gif"></var> and this <var class="zed">X</var> are 
about the same size: <var class="zed"><img height=11 width=9 alt="\power" src="zimg/power-m.gif"> X</var>.  See these <a href="z-viewing-tips.html">viewing tips</a>.
</p>


<hr>

<center>
<h4>Formal specification of control software for a radiation therapy
machine</h4>
<p>
Jonathan Jacky, Michael Patrick and Jonathan Unger
<p>
January, 1997
<p>
<strong>Abstract</strong>
</center>

<blockquote>
<p>
This report presents a formal (mathematical) specification for the
operator's console of a computer-controlled radiation therapy machine
equipped with a multileaf collimator.  This formal specification,
rather than the prose specification, serves as the primary reference
source for programming and test planning.
<p>
Specified functions include selecting treatment setups from a database
of stored prescriptions, setting up prescriptions on the treatment
machine manually or semi-automatically, checking that the setup
conforms to the prescription (with provision for overriding certain
settings, with operator confirmation), safety interlocking and
essential user interface features.  The specification supports physics
and experimental procedures as well as normal patient treatments.
<p>
The specification is expressed in the Z notation.  It formalizes the
requirements in a thorough informal (English prose) specification.
Its organization suggests a detailed design.
</blockquote>

<hr>

<h2><a name="Contents">Contents</a></h2>

<p>
<a href="#Introduction">Introduction</a><br>
<a href="#Overview">Overview</a><br> 
<a href="#System configuration">System configuration</a><br> 
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Settings and registers">Settings and registers</a><br> 
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Values">Values</a><br> 
<a href="#Prescription database">Prescription database</a><br> 
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Operators">Operators</a><br> 
<a href="#Session">Session</a><br> 
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Session state">Session state</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Operations on Session">Operations on Session</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Experiment mode">Experiment mode</a><br> 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Store Field">Store Field</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Login">Login</a><br> 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Select Patient">Select Patient</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Select Field">Select Field</a><br>
<a href="#Field">Field</a><br> 
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Field state">Field state</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Relation to Session state">Relation to Session state</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Initialization">Initialization</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Operations on Field">Operations on Field</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Select Patient">Select Patient</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Select Field">Select Field</a><br> 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Edit setting">Edit setting</a><br>  
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Override">Override</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Store Field">Store Field</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Experiment Mode">Experiment Mode</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Calibration factors">Calibration factors</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Dosimetry calibration">Dosimetry calibration</a><br>
<a href="#Software interlocks and status flags">Software interlocks and status flags</a><br> 
<a href="#User interface">User interface</a><br> 
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Console state">Console state</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Elements of user interaction">Elements of user interaction</a><br> 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Available">Available</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Lists">Lists</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Tables">Tables</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Confirm">Confirm</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Menu">Menu</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Dialog">Dialog</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Therapy console operations">Therapy console operations</a><br> 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Relation to Session state">Relation to Session state</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Op operations">Op operations</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#SelectDisplay operations">SelectDisplay operations</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#SelectList operations">SelectList operations</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#SelectTable operations">SelectTable operations</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ConfirmOp operations">ConfirmOp operations</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#MenuOp operations">MenuOp operations</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#DialogOp operations">DialogOp operations</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Setup operations">Setup operations</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Cancel operations">Cancel operations</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#AcceptConfirm operations">AcceptConfirm operations</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Accept operations">Accept operations</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Logout and login">Logout and login</a><br> 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Other operations">Other operations</a><br>
<a href="#Combining the subsystems">Combining the subsystems</a><br> 
<p>

<hr>

<h2><a name="Introduction">Introduction</a></h2>

<p class="informal">
This report presents portions of a formal specification for a real
medical device, a radiation therapy machine. This specification,
rather than the informal prose description, serves as the primary
reference source for programming and test plannning.  A paper <a
href="ftp://ftp.radonc.washington.edu:/pub/cnts-papers/zum95">[jacky95b]</a>
describes the development of part of the program based on the contents
of this report.
</p>

<p class="informal">
This formal specification is based on a thorough informal (English
prose) specification presented as Chapters 2 and 8 in
<a href="ftp://ftp.radonc.washington.edu:/pub/cnts-reports/spec2">[jacky92]</a>.
Here we attempt to formalize the requirements in that
source.  We have included many cross-references.  Decimal numbers and
integers (as in 8.4, 191) refer to chapter, section and page numbers
in <a href="ftp://ftp.radonc.washington.edu:/pub/cnts-reports/spec2">[jacky92]</a>, respectively.
</p>

<p class="informal">
The formal specification is expressed in the Z notation <a
href="http://spivey.oriel.ox.ac.uk/mike/zrm/">[spivey92]</a>.  We
have corrected syntax and type errors detected by a checker <a
href="http://spivey.oriel.ox.ac.uk/mike/fuzz/">[spivey92a]</a>.
</p>

<h2><a name="Overview">Overview</a></h2> 

<p class="informal">
Much of the apparent complexity in the prose requirements arises from
the interaction of several subsystems which, by themselves, are
simpler.  In the formal specification we partition the system
into subsystems and describe simple operations on each.  For each
operation on the system as a whole, we define a separate operation on
each affected subsystem.  The complex behaviors of the whole system
emerge when we compose these simpler operations together.  
</p>

<p class="informal">
Each subsystem is modelled by a Z state schema and a number of operation
schemas on that state. This partition can itself be represented in Z.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">TherapyControl</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>Session </td></tr>
<tr> <td></td><td class="zed" colspan=2>Field </td></tr>
<tr> <td></td><td class="zed" colspan=2>Intlk </td></tr>
<tr> <td></td><td class="zed" colspan=2>... </td></tr>
<tr> <td></td><td class="zed" colspan=2>Console </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
<var class="zed">Session</var> (section <a href="#Session">[sect:session]</a>) models those aspects of the
treatment session that are related to the prescription database
(section <a href="#Prescription database">[sect:prescr]</a> models the database itself).  <var class="zed">Field</var>
(section <a href="#Field">[sect:field]</a>) models the many settings that characterize
a single field.  <var class="zed">Intlk</var> (section <a href="#Software interlocks and status flags">[sect:intlk]</a>) models software
interlocks and other flags that indicate readiness. <var class="zed">Console</var>
(section <a href="#User interface">[sect:ui]</a>) models the user interface.
Section&nbsp;[sect:compose] combines operations from <var class="zed">Session</var>, <var class="zed">Field</var>
and <var class="zed">Console</var>.
</p>

<p class="informal">
Related operations in different subsystems are distinguished by
suffix: <var class="zed">ExptModeS</var>, <var class="zed">ExptModeF</var>, and <var class="zed">ExptModeC</var> are operations in
the <var class="zed">Session</var>, <var class="zed">Field</var> and <var class="zed">Console</var> subsystems, respectively.  
</p>

<p class="informal">
Each user interface operation in the <var class="zed">Console</var> subsystem ensures that
corresponding operations in the <var class="zed">Session</var> and <var class="zed">Field</var> subsystems are only
invoked when their preconditions are satisfied.  Therefore only the
<var class="zed">Console</var> operations need to be total; usually there is no need to
define total operations in the <var class="zed">Session</var> and <var class="zed">Field</var> subsystems.  For
example the <var class="zed">ExptModeC</var> operation in the <var class="zed">Console</var> subsystem checks the
precondition that only physicists can invoke this operation; in
<var class="zed">Console</var> we define what happens when an operator who is not a
physicist attempts to enter experiment mode.  Therefore <var class="zed">ExptModeS</var>
and <var class="zed">ExptModeF</var> can assume that this precondition has been satisfied
and need not cover the other cases.
</p>

<h2><a name="System configuration">System configuration</a></h2> 

<p class="informal">
Fixed aspects of the system configuration are represented by Z global
constants: sets, functions and relations.  This section introduces
some of these constants.  It should be possible to accommodate some
configuration changes simply by changing their values.
</p>

<h3><a name="Settings and registers">Settings and registers</a></h3> 

<p class="informal">
The state of the therapy machine is largely determined by the values
of named <var class="zed">items</var>.  At this writing the list of items is
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0> 
<tr> <td class="zed">ITEM ::= nfrac | dose_tot | dose | wedge | w_rot | filter | leaf0 | leaf39 | </td></tr>
<tr> <td class="zed"><img width=30 height=1 align=bottom alt="    " src="zimg/clear.gif">gantry | collim | turnt | lat | longit | height | doseB | top | </td></tr>
<tr> <td class="zed"><img width=30 height=1 align=bottom alt="    " src="zimg/clear.gif">pt_mode | pt_factor | press | temp | d_rate | t_fac | </td></tr>
<tr> <td class="zed"><img width=30 height=1 align=bottom alt="    " src="zimg/clear.gif">calvolt1 | calvolt2 | p_dose | p_time | e_time</td></tr>
</table>
</div>

<p class="informal">
For brevity we omit formal declarations of the other collimator <var class="zed">leaves</var>,
<var class="zed">leaf1 .. leaf38</var>.
</p>

<p class="informal">
There are many items but we can identify different subsets, where all
of the members of each subset are treated the same way for some
particular purpose.
</p>
  
<p class="informal">
<var class="zed">Settings</var> are items which are included in field prescriptions.  Other
items are kept in <var class="zed">registers</var>.  In particular <var class="zed">dose_reg</var> items
include calibration factors and other items concerned with the
dosimetry system (In the C implementation <var class="zed">setting</var> and
<var class="zed">dose_reg</var> are two different enumerations, separated so we can
efficiently store and index zero-based C arrays.  We may add other
register enumerations in the future, for example for the LCC
calibration factors.).
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td width=1 rowspan=99 bgcolor=black><img width=1 height=1 alt="\begin{axdef}" src="zimg/clear.gif"><br></td></tr>
<tr> <td></td><td class="zed" colspan=2>setting, dose_reg: <img height=11 width=9 alt="\power" src="zimg/power-m.gif"> ITEM </td></tr>
<tr><td width=10 height=1><img width=10 height=1 alt="\end{axdef}" src="zimg/clear.gif"></td></tr>
</table>
</div>

<p class="informal">
At this writing
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed"><img width=5 height=14 align=absbottom alt="\langle" src="zimg/langle-m.gif"> setting, dose_reg <img width=5 height=14 align=absbottom alt="\rangle" src="zimg/rangle-m.gif"> <b>partition</b> ITEM</td></tr>
<tr> <td class="zed"><img width=1 height=10 align=bottom alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td class="zed">dose_reg = { pt_mode, pt_factor, press, temp, d_rate, t_fac, </td></tr>
<tr> <td class="zed"><img width=30 height=1 align=bottom alt="    " src="zimg/clear.gif">calvolt1, calvolt2, p_dose, p_time, e_time )</td></tr>
</table>
</div>

<p class="informal">
<em>Scales</em> are items that are continously variable over some range;
examples are gantry angle and every collimator leaf position.  
<em>Selections</em> can only take on certain discrete values; examples are
wedge and flattening filter selection.  <em>Counters</em> accumulate
during treatment runs; examples are dose and the number of fractions.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td width=1 rowspan=99 bgcolor=black><img width=1 height=1 alt="\begin{axdef}" src="zimg/clear.gif"><br></td></tr>
<tr> <td></td><td class="zed" colspan=2>scale, selection, counter: <img height=11 width=9 alt="\power" src="zimg/power-m.gif"> ITEM</td></tr>
<tr><td width=10 height=1><img width=10 height=1 alt="\end{axdef}" src="zimg/clear.gif"></td></tr>
</table>
</div>

<p class="informal">
At this writing
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed"><img width=5 height=14 align=absbottom alt="\langle" src="zimg/langle-m.gif"> selection, scale, counter <img width=5 height=14 align=absbottom alt="\rangle" src="zimg/rangle-m.gif"> <b>partition</b> ITEM</td></tr>
<tr> <td class="zed"><img width=1 height=10 align=bottom alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td class="zed">counter = { nfrac, dose_tot, dose } </td></tr>
<tr> <td class="zed">selection = { wedge, w_rot, filter, pt_mode } </td></tr>
</table>
</div>

<p class="informal">
A field is prescribed by determining the values of certain of its
settings.  Therapy fields are defined by the values of particular
settings called <em>prescriptions</em>.  Experiment fields are defined by
the values of settings called <em>presets</em> (8.2, 171 third bullet;
Table 8.2, 173).  Readiness is determined by checking all the <var class="zed">preset</var>
settings in experiment mode, and all the <var class="zed">prescr</var> settings (<var class="zed">prescrip</var>
except the linear table motions) in therapy mode (8.9.8, 194).
Most settings are machine <var class="zed">motions</var>, and the actual values of most
settings are measured by <var class="zed">sensors</var>.  The <em>calibration constants</em>
are registers that are initially loaded with constants stored in the
calibration database.  At this writing
</p>



<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed">leaves == { leaf0, leaf39 }</td></tr>
<tr> <td class="zed"><img width=1 height=10 align=bottom alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td class="zed">preset == leaves <img width=10 height=7 alt="\cup" src="zimg/cup-m.gif"> {wedge, w_rot, filter }</td></tr>
<tr> <td class="zed"><img width=1 height=10 align=bottom alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td class="zed">motion == preset <img width=10 height=7 alt="\cup" src="zimg/cup-m.gif"> { gantry, collim, turnt, lat, longit, height }</td></tr>
<tr> <td class="zed"><img width=1 height=10 align=bottom alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td class="zed">prescrip == motion <img width=10 height=7 alt="\cup" src="zimg/cup-m.gif"> counter </td></tr>
<tr> <td class="zed"><img width=1 height=10 align=bottom alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td class="zed">prescr == prescrip \ { lat, longit, height }</td></tr>
<tr> <td class="zed"><img width=1 height=10 align=bottom alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td class="zed">sensor == setting \ { nfrac, dose_tot }</td></tr>
<tr> <td class="zed"><img width=1 height=10 align=bottom alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td class="zed">cal_const == { d_rate, t_fac, calvolt1, calvolt2 }</td></tr>
</table>
</div>


<h3><a name="Values">Values</a></h3> 

<p class="informal">
The value of every item can be represented by a number.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed">VALUE == <img height=11 width=10 alt="\num" src="zimg/num-m.gif"></td></tr>
</table>
</div>

<p class="informal">
Each item will be implemented by an appropriate
(possibly floating point) numeric type.  In this report it is
sufficient to say they are all numbers, to indicate that we can
do arithmetic with them.
</p>

<p class="informal">
Each item can assume a particular range of <var class="zed">valid</var> (physically
achievable) values.  For example, the gantry angle can vary from 0 to
359 (In the implementation gantry angle varies from 0.0 to
359.9. Decimal fractions are not built into Z.); the available wedge
selections are <var class="zed">no_wedge</var>, 30, 45 and 60.  We use <var class="zed">valid</var> to do range
checking on numbers that the operator types in, and also on
sensor readings, to check for faults (The
C implementation includes one <var class="zed">valid</var> array indexed by <var class="zed">setting</var> and
another (with a different name) indexed by <var class="zed">dose_reg</var>.).  Every
setting&nbsp;<var class="zed">s</var> has some valid values, and there is always a minimum and a
maximum valid value. We define
an uninitialized or <var class="zed">blank</var> value which is not valid for any setting.
For each <var class="zed">scale</var> item, there is a <em>tolerance</em> within which
variations in value are acceptable.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td width=1 rowspan=99 bgcolor=black><img width=1 height=1 alt="\begin{axdef}" src="zimg/clear.gif"><br></td></tr>
<tr> <td></td><td class="zed" colspan=2>blank: VALUE </td></tr>
<tr> <td></td><td class="zed" colspan=2>        tol: scale <img width=14 height=8 alt="\fun" src="zimg/fun-m.gif"> VALUE </td></tr>
<tr> <td></td><td class="zed" colspan=2>valid: ITEM <img width=14 height=8 alt="\fun" src="zimg/fun-m.gif"> <img height=11 width=8 alt="\finset" src="zimg/finset-m.gif"><sub><font size=-3>1</font></sub> VALUE</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=9 height=10 alt="\forall" src="zimg/forall-m.gif"> s: ITEM <img width=7 height=7 alt="@" src="zimg/spot-m.gif"> blank <img width=7 height=11 align=absbottom alt="\notin" src="zimg/notin-m.gif"> valid&nbsp;s </td></tr>
<tr><td width=10 height=1><img width=10 height=1 alt="\end{axdef}" src="zimg/clear.gif"></td></tr>
</table>
</div>


<h2><a name="Prescription database">Prescription database</a></h2> 

<p class="informal">
The prescription database stores patients and fields.  We define a
basic type for the names that identify them.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed">[NAME]</td></tr>
<tr> <td class="zed"><img width=1 height=10 align=bottom alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td class="zed">PATIENT == NAME; FIELD == NAME</td></tr>
</table>
</div>

<p class="informal">
An item's name usually corresponds to the text string that identifies
it in screen displays and log files (We define one type for
both kinds of names so the same specifications (and code) can be used
to handle lists of patients and fields.  In the implementation,
elements of <var class="zed">NAME</var> are integer indices into arrays, usually of C
structures that include the name string as one member.).
</p>

<p class="informal">
We distinguish a special value to indicate that no name has been
selected.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td width=1 rowspan=99 bgcolor=black><img width=1 height=1 alt="\begin{axdef}" src="zimg/clear.gif"><br></td></tr>
<tr> <td></td><td class="zed" colspan=2>no_name: NAME </td></tr>
<tr><td width=10 height=1><img width=10 height=1 alt="\end{axdef}" src="zimg/clear.gif"></td></tr>
</table>
</div>

<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed"> no_patient == no_name; no_field == no_name </td></tr>
</table>
</div>

<p class="informal">
In experiment mode, we store fields under <em>studies</em> which are
analogous to patients.  In our model they have the same type.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td width=1 rowspan=99 bgcolor=black><img width=1 height=1 alt="\begin{axdef}" src="zimg/clear.gif"><br></td></tr>
<tr> <td></td><td class="zed" colspan=2>studies,patients: <img height=11 width=9 alt="\power" src="zimg/power-m.gif"> PATIENT</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>no_patient <img width=7 height=11 align=absbottom alt="\notin" src="zimg/notin-m.gif"> studies <img width=8 height=7 alt="\land" src="zimg/land-m.gif"> no_patient <img width=7 height=11 align=absbottom alt="\notin" src="zimg/notin-m.gif"> patients</td></tr>
<tr><td width=10 height=1><img width=10 height=1 alt="\end{axdef}" src="zimg/clear.gif"></td></tr>
</table>
</div>

<p class="informal">
For each patient or study, several prescribed fields are
stored (This differs from&nbsp;[jacky90d], which describes a
single collection of experiment fields.  Moreoever, for each
experiment field we now store the same <var class="zed">prescrip</var> settings as for
therapy fields, although we only check the <var class="zed">preset</var> settings for
agreement with the stored prescription).  We must check against
delivering too many fractions or monitor units from the same field
(8.9.4, 187 -- 188), so the accumulated values of the counters are
also stored (for patient fields only).
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed">ACCUMULATION == counter <img width=14 height=8 alt="\fun" src="zimg/fun-m.gif"> VALUE</td></tr>
<tr> <td class="zed"><img width=1 height=10 align=bottom alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td class="zed"> PRESCRIPTION == prescrip <img width=14 height=8 alt="\fun" src="zimg/fun-m.gif"> VALUE</td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td width=1 rowspan=99 bgcolor=black><img width=1 height=1 alt="\begin{axdef}" src="zimg/clear.gif"><br></td></tr>
<tr> <td></td><td class="zed" colspan=2>Preset: studies <img width=14 height=8 alt="\fun" src="zimg/fun-m.gif"> (FIELD <img width=14 height=8 alt="\pfun" src="zimg/pfun-m.gif"> PRESCRIPTION) </td></tr>
<tr> <td></td><td class="zed" colspan=2>Prescribed: patients <img width=14 height=8 alt="\fun" src="zimg/fun-m.gif"> (FIELD <img width=14 height=8 alt="\pfun" src="zimg/pfun-m.gif"> PRESCRIPTION) </td></tr>
<tr> <td></td><td class="zed" colspan=2>Accumulated: patients <img width=14 height=8 alt="\fun" src="zimg/fun-m.gif"> (FIELD <img width=14 height=8 alt="\pfun" src="zimg/pfun-m.gif"> ACCUMULATION) </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=9 height=10 alt="\forall" src="zimg/forall-m.gif"> s: studies <img width=7 height=7 alt="@" src="zimg/spot-m.gif"> no_field <img width=7 height=11 align=absbottom alt="\notin" src="zimg/notin-m.gif"> <b>dom</b> (Preset&nbsp;s) </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=9 height=10 alt="\forall" src="zimg/forall-m.gif"> p: patients <img width=7 height=7 alt="@" src="zimg/spot-m.gif"> no_field <img width=7 height=11 align=absbottom alt="\notin" src="zimg/notin-m.gif"> <b>dom</b> (Prescribed&nbsp;p)</td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=8 height=7 alt="\land" src="zimg/land-m.gif"> <b>dom</b>&nbsp;(Prescribed&nbsp;p) = <b>dom</b>&nbsp;(Accumulated&nbsp;p) </td></tr>
<tr><td width=10 height=1><img width=10 height=1 alt="\end{axdef}" src="zimg/clear.gif"></td></tr>
</table>
</div>


<p class="informal">
The <var class="zed">exceeded</var> predicate tests whether the prescribed fractional dose,
total dose or number of fractions have already been delivered.
</p>


<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td width=1 rowspan=99 bgcolor=black><img width=1 height=1 alt="\begin{axdef}" src="zimg/clear.gif"><br></td></tr>
<tr> <td></td><td class="zed" colspan=2>exceeded _ : ACCUMULATION <img width=13 height=8 alt="\rel" src="zimg/rel-m.gif"> PRESCRIPTION</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=9 height=10 alt="\forall" src="zimg/forall-m.gif"> counters: ACCUMULATION; fields: PRESCRIPTION <img width=7 height=7 alt="@" src="zimg/spot-m.gif"> </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=10 height=1 align=bottom alt="    " src="zimg/clear.gif"> exceeded(counters,fields) <img width=13 height=7 alt="\iff" src="zimg/iff-m.gif"> (<img width=6 height=10 alt="\exists" src="zimg/exists-m.gif"> c: counter <img width=7 height=7 alt="@" src="zimg/spot-m.gif"> counters&nbsp;c <img width=7 height=9 alt="\geq" src="zimg/geq-m.gif"> fields&nbsp;c)</td></tr>
<tr><td width=10 height=1><img width=10 height=1 alt="\end{axdef}" src="zimg/clear.gif"></td></tr>
</table>
</div>

<p class="informal">
In the following discussion consider field <var class="zed">f</var> of patient <var class="zed">p</var>; let
<var class="zed">prescribed = Prescribed&nbsp;p&nbsp;f</var> and <var class="zed">accumulated = Accumulated&nbsp;p&nbsp;f</var>.
The prescription includes the number of fractions <var class="zed">prescribed&nbsp;n</var> and
the total dose <var class="zed">prescribed&nbsp;dose_tot</var>.  We also keep track of the
number of fractions accumulated to date <var class="zed">accumulated&nbsp;n</var>, the number of
monitor units delivered since the beginning of the day
<var class="zed">accumulated&nbsp;dose</var> and the total number of monitor units accumulated
to date <var class="zed">accumulated&nbsp;dose_tot</var> (8.9.4, Fig. 83, 186).
</p>


<h3><a name="Operators">Operators</a></h3> 

<p class="informal">
Our <var class="zed">OPERATOR</var> type includes the operator's username and password.  A
special value indicates no operator has logged in.  Physicists are
operators who are authorized to use the equipment in its experiment
mode (8.2, 170).
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed"> [OPERATOR] </td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td width=1 rowspan=99 bgcolor=black><img width=1 height=1 alt="\begin{axdef}" src="zimg/clear.gif"><br></td></tr>
<tr> <td></td><td class="zed" colspan=2>no_operator: OPERATOR </td></tr>
<tr> <td></td><td class="zed" colspan=2>operators, physicists: <img height=11 width=9 alt="\power" src="zimg/power-m.gif"> OPERATOR</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>physicists <img width=9 height=10 align=absbottom alt="\subseteq" src="zimg/subseteq-m.gif"> operators</td></tr>
<tr><td width=10 height=1><img width=10 height=1 alt="\end{axdef}" src="zimg/clear.gif"></td></tr>
</table>
</div>


<h2><a name="Session">Session</a></h2> 

<p class="informal">
In this section we model those aspects of the treatment session that
are related to the prescription database.  In
section&nbsp;[sect:compose], we will combine the operations defined
here with user interface operations described in
section <a href="#User interface">[sect:ui]</a>.
</p>

<h3><a name="Session state">Session state</a></h3>

<p class="informal">
The <var class="zed">Session</var> state is determined by the treatment <var class="zed">mode</var>, the
<var class="zed">operator</var> on duty, the currently selected <var class="zed">patient</var> and <var class="zed">field</var>, the
accessible <var class="zed">names</var> (patients or studies), and the accessible
prescribed <var class="zed">fields</var> and their <var class="zed">counters</var>.  We first define
<var class="zed">SessionVars</var> which declares all the state variables and provides
predicates to ensure that the operator is authorized for the mode, and
the names are consistent with the mode.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed">MODE ::= therapy | experiment</td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">SessionVars</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>mode: MODE </td></tr>
<tr> <td></td><td class="zed" colspan=2>operator: OPERATOR </td></tr>
<tr> <td></td><td class="zed" colspan=2>patient: PATIENT </td></tr>
<tr> <td></td><td class="zed" colspan=2>field: FIELD </td></tr>
<tr> <td></td><td class="zed" colspan=2>names: <img height=11 width=9 alt="\power" src="zimg/power-m.gif"> PATIENT </td></tr>
<tr> <td></td><td class="zed" colspan=2>fields: FIELD <img width=14 height=8 alt="\pfun" src="zimg/pfun-m.gif"> PRESCRIPTION </td></tr>
<tr> <td></td><td class="zed" colspan=2>counters: FIELD <img width=14 height=8 alt="\pfun" src="zimg/pfun-m.gif"> ACCUMULATION </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>operator = no_operator <img width=8 height=7 alt="\lor" src="zimg/lor-m.gif"> operator <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> operators </td></tr>
<tr> <td></td><td class="zed" colspan=2>mode = experiment <img width=13 height=7 alt="\implies" src="zimg/implies-m.gif"> operator <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> physicists </td></tr>
<tr> <td></td><td class="zed" colspan=2>names = <b>if</b> mode = therapy <b>then</b> patients <b>else</b> studies</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
Next, we define two cases.  When no patient is selected, no
prescribed fields are accessible; no field can be selected.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">NoPatient</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>SessionVars</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>patient = no_patient </td></tr>
<tr> <td></td><td class="zed" colspan=2>field = no_field </td></tr>
<tr> <td></td><td class="zed" colspan=2>fields = <img width=11 height=11 alt="\emptyset" src="zimg/emptyset-m.gif"> </td></tr>
<tr> <td></td><td class="zed" colspan=2>counters = <img width=11 height=11 alt="\emptyset" src="zimg/emptyset-m.gif"> </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
When a patient is selected, that patient's fields are accessible.
If a field is selected, it must be one of these.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">PrescribedPatient</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>SessionVars</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>patient <img width=7 height=7 alt="\neq" src="zimg/neq-m.gif"> no_patient </td></tr>
<tr> <td></td><td class="zed" colspan=2>patient <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> names </td></tr>
<tr> <td></td><td class="zed" colspan=2>field = no_field <img width=8 height=7 alt="\lor" src="zimg/lor-m.gif"> field <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> <b>dom</b> fields </td></tr>
<tr> <td></td><td class="zed" colspan=2>fields = <b>if</b> mode = therapy <b>then</b> Prescribed&nbsp;patient <b>else</b> Preset&nbsp;patient </td></tr>
<tr> <td></td><td class="zed" colspan=2>mode = therapy <img width=13 height=7 alt="\implies" src="zimg/implies-m.gif"> counters = Accumulated&nbsp;patient </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
Together these define the <var class="zed">Session</var> state.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed"> Session <img height=11 width=11 alt="\defs" src="zimg/defs-m.gif"> PrescribedPatient <img width=8 height=7 alt="\lor" src="zimg/lor-m.gif"> NoPatient </td></tr>
</table>
</div>

<p class="informal">
The <var class="zed">Session</var> subsystem starts up in therapy mode with no operator and
no patient.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">InitSession</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>NoPatient</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>mode = therapy </td></tr>
<tr> <td></td><td class="zed" colspan=2>operator = no_operator </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
None of the <var class="zed">Session</var> state variables are sensor inputs; all are under
program control.
</p>

<h3><a name="Operations on Session">Operations on Session</a></h3>

<p class="informal">
In the following subsections we model the operations on <var class="zed">Session</var>.  We
will put together the operations defined in different states in
section <a href="#Combining the subsystems">[sect:compose]</a>, below.
</p>

<h4><a name="Experiment mode">Experiment mode</a></h4> 

<p class="informal">
Physicists can toggle the session from therapy mode to experiment mode
and back (This is a change from the original requirements
in&nbsp;[jacky90d], where <b>Experiment Mode</b> switches to experiment
mode but <b>Select Patient</b> switches back to therapy mode.). The
user interface ensures that only physicists can invoke this operation,
so there is no need here to define a total operation that describes
what happens when an operator who is not a physicist attempts this
operation.  After switching modes, no patient (study) and no field are
selected (8.9.6, 190 -- 191).
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">ExptModeS</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=7 height=10 alt="\Delta" src="zimg/Delta-m.gif"> Session </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>operator <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> physicists </td></tr>
<tr> <td></td><td class="zed" colspan=2>NoPatient' </td></tr>
<tr> <td></td><td class="zed" colspan=2>(mode',names') = <b>if</b> mode = therapy <b>then</b> (experiment,studies) </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=90 height=1 align=bottom alt="    " src="zimg/clear.gif"><b>else</b> (therapy,patients) </td></tr>
<tr> <td></td><td class="zed" colspan=2>operator' = operator</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>


<h4><a name="Store Field">Store Field</a></h4>

<p class="informal">
<b>Store Field</b> (8.9.5, 189 -- 188) accepts a new field name, which
becomes the selected field and is also added to the list of
fields (The prose <a href="ftp://ftp.radonc.washington.edu:/pub/cnts-reports/spec2">[jacky92]</a> also requires that the new
field be added to the prescription database for the current patient.
We do not model this formally (in fact we model the prescription
database as a constant).  The precondition <var class="zed">patient <img width=7 height=7 alt="\neq" src="zimg/neq-m.gif"> no_patient</var>
is not explicit in the prose.).
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">StoreFieldS</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=7 height=10 alt="\Delta" src="zimg/Delta-m.gif"> Session </td></tr>
<tr> <td></td><td class="zed" colspan=2>field?: FIELD </td></tr>
<tr> <td></td><td class="zed" colspan=2>prescribed': PRESCRIPTION </td></tr>
<tr> <td></td><td class="zed" colspan=2>accumulated': ACCUMULATION </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>patient <img width=7 height=7 alt="\neq" src="zimg/neq-m.gif"> no_patient </td></tr>
<tr> <td></td><td class="zed" colspan=2>field' = field? </td></tr>
<tr> <td></td><td class="zed" colspan=2>fields' = fields <img width=10 height=7 alt="\cup" src="zimg/cup-m.gif"> { field' <img height=9 width=10 alt="\mapsto" src="zimg/mapsto-m.gif"> prescribed' } </td></tr>
<tr> <td></td><td class="zed" colspan=2>mode = therapy <img width=13 height=7 alt="\implies" src="zimg/implies-m.gif"> counters' = counters <img width=10 height=7 alt="\cup" src="zimg/cup-m.gif"> { field' <img height=9 width=10 alt="\mapsto" src="zimg/mapsto-m.gif"> accumulated' } </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=1 height=10 align=bottom alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>mode' = mode </td></tr>
<tr> <td></td><td class="zed" colspan=2>operator' = operator </td></tr>
<tr> <td></td><td class="zed" colspan=2>patient' = patient </td></tr>
<tr> <td></td><td class="zed" colspan=2>names' = names </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
Here <var class="zed">prescribed'</var> and <var class="zed">accumulated'</var> are just place holders; their
values are defined in the corresponding <var class="zed">Field</var> operation
<var class="zed">StoreFieldF</var>.
</p>

<h4><a name="Login">Login</a></h4> 

<p class="informal">
<b>Login</b> (2.5.2, 17 -- 20; 8.9.1, 183) accepts a new <var class="zed">operator?</var>.
The user interface ensures that the new operator is authorized.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">NewOperator</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=7 height=10 alt="\Delta" src="zimg/Delta-m.gif"> Session </td></tr>
<tr> <td></td><td class="zed" colspan=2>operator?: OPERATOR</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>operator' = operator? </td></tr>
<tr> <td></td><td class="zed" colspan=2>operator' <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> operators</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
There are two variations.  Usually the new operator is sufficiently
privileged to keep the same mode.  Otherwise the session reverts to
therapy mode with no patient and no field (8.9.6, 190).
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">Privileged</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>NewOperator</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>mode = therapy <img width=8 height=7 alt="\lor" src="zimg/lor-m.gif"> operator' <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> physicists </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=1 height=10 align=bottom alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>mode' = mode </td></tr>
<tr> <td></td><td class="zed" colspan=2>patient' = patient </td></tr>
<tr> <td></td><td class="zed" colspan=2>names' = names </td></tr>
<tr> <td></td><td class="zed" colspan=2>field' = field </td></tr>
<tr> <td></td><td class="zed" colspan=2>fields' = fields </td></tr>
<tr> <td></td><td class="zed" colspan=2>counters' = counters </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">Unprivileged</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>NewOperator</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>        mode = experiment </td></tr>
<tr> <td></td><td class="zed" colspan=2>        operator <img width=7 height=11 align=absbottom alt="\notin" src="zimg/notin-m.gif"> physicists </td></tr>
<tr> <td></td><td class="zed" colspan=2>mode' = therapy </td></tr>
<tr> <td></td><td class="zed" colspan=2>NoPatient'</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed">LoginS <img height=11 width=11 alt="\defs" src="zimg/defs-m.gif"> Privileged <img width=8 height=7 alt="\lor" src="zimg/lor-m.gif"> Unprivileged</td></tr>
</table>
</div>


<h4><a name="Select Patient">Select Patient</a></h4>

<p class="informal">
In <b>Select Patient</b> (8.9.3, 184 -- 185) the patient's
prescribed fields are loaded, but no field is selected
 (The prose&nbsp;[jacky90d] says that if the patient list is
selected in experiment mode, the session reverts to therapy mode
(8.9.3, 184 last paragraph).  We have dropped this requirement.).  The
user interface ensures that the new patient is in the prescription
database.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">SelectPatientS</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=7 height=10 alt="\Delta" src="zimg/Delta-m.gif"> Session </td></tr>
<tr> <td></td><td class="zed" colspan=2>patient?: PATIENT</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>patient? <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> names </td></tr>
<tr> <td></td><td class="zed" colspan=2>patient' = patient? </td></tr>
<tr> <td></td><td class="zed" colspan=2>field' = no_field </td></tr>
<tr> <td></td><td class="zed" colspan=2>fields' = <b>if</b> mode = therapy <b>then</b> Prescribed&nbsp;patient' <b>else</b> Preset&nbsp;patient' </td></tr>
<tr> <td></td><td class="zed" colspan=2>mode = therapy <img width=13 height=7 alt="\implies" src="zimg/implies-m.gif"> counters' = Accumulated&nbsp;patient' </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=1 height=10 align=bottom alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>mode' = mode  </td></tr>
<tr> <td></td><td class="zed" colspan=2>operator' = operator </td></tr>
<tr> <td></td><td class="zed" colspan=2>names' = names</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>


<h4><a name="Select Field">Select Field</a></h4>

<p class="informal">
<b>Select Field</b> (8.9.4, 186 -- 189) changes the current field.
The user interface ensures this operation cannot occur if there is no
patient, and ensures that the new field is prescribed.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">SelectFieldS</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=7 height=10 alt="\Delta" src="zimg/Delta-m.gif"> Session </td></tr>
<tr> <td></td><td class="zed" colspan=2>field?: FIELD</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>patient <img width=7 height=7 alt="\neq" src="zimg/neq-m.gif"> no_patient </td></tr>
<tr> <td></td><td class="zed" colspan=2>field? <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> <b>dom</b> fields </td></tr>
<tr> <td></td><td class="zed" colspan=2>field' = field? </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=1 height=10 align=bottom alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>operator' = operator </td></tr>
<tr> <td></td><td class="zed" colspan=2>mode' = mode </td></tr>
<tr> <td></td><td class="zed" colspan=2>patient' = patient </td></tr>
<tr> <td></td><td class="zed" colspan=2>fields' = fields </td></tr>
<tr> <td></td><td class="zed" colspan=2>counters' = counters</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>


<h2><a name="Field">Field</a></h2> 

<p class="informal">
In this section, we look inside the machine state and deal
with particular machine settings.  We model operations that involve
the many settings that characterize a single field.
</p>

<h3><a name="Field state">Field state</a></h3>

<p class="informal">
The <var class="zed">Field</var> schema includes the state variables that represent
settings for the currently selected <var class="zed">field</var> and <var class="zed">mode</var>.  <var class="zed">Sensors</var>
report <var class="zed">measured</var> setting values.  <var class="zed">Prescribed</var> setting values are
read from the prescription database.
</p>

<p class="informal">
<var class="zed">Computed</var> and <var class="zed">calibrated</var> item values are entered by the operator or
calculated from prescribed settings and calibration constants; these
are stored in <var class="zed">registers</var>.  Certain <em>calibration constants</em> are
stored in files (8.9.13, 213 first full paragraph; 215 last
paragraph).  <var class="zed">Counters</var> hold setting values that are <var class="zed">accumulated</var>
over successive runs.  For example, the <var class="zed">dose</var> prescribed for a single
fraction may be have to be delivered in two or more treatment runs.
</p>

<p class="informal">
Some settings that do not match their prescribed values can be
<var class="zed">overridden</var> by the operator (8.4, 175 second paragraph; 8.8.1, 181).
It is necessary to store the value of each setting when it is
overridden (see the requirement in the last paragraph under
``override'' on p.  181).  Only settings that are prescribed can be
overridden.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td width=1 rowspan=99 bgcolor=black><img width=1 height=1 alt="\begin{axdef}" src="zimg/clear.gif"><br></td></tr>
<tr> <td></td><td class="zed" colspan=2>cal_factor: cal_const <img width=14 height=8 alt="\fun" src="zimg/fun-m.gif"> VALUE</td></tr>
<tr><td width=10 height=1><img width=10 height=1 alt="\end{axdef}" src="zimg/clear.gif"></td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">Field</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>prescribed: PRESCRIPTION </td></tr>
<tr> <td></td><td class="zed" colspan=2>accumulated: ACCUMULATION </td></tr>
<tr> <td></td><td class="zed" colspan=2>measured: sensor <img width=14 height=8 alt="\fun" src="zimg/fun-m.gif"> VALUE </td></tr>
<tr> <td></td><td class="zed" colspan=2>overridden: prescr <img width=14 height=8 alt="\pfun" src="zimg/pfun-m.gif"> VALUE </td></tr>
<tr> <td></td><td class="zed" colspan=2>computed, calibrated: dose_reg <img width=14 height=8 alt="\fun" src="zimg/fun-m.gif"> VALUE </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
The <var class="zed">measured</var> settings are read from sensors so here we cannot write any
predicates that constrain them.
</p>

<h3><a name="Relation to Session state">Relation to Session state</a></h3>

<p class="informal">
A few operations on <var class="zed">Field</var> read the <var class="zed">mode</var> and <var class="zed">field</var> state variables
declared in <var class="zed">Session</var>.  In therapy mode, the <var class="zed">prescribed</var> settings in
the <var class="zed">Field</var> state are those from the prescription database entry for
the currently selected <var class="zed">mode</var> and <var class="zed">field</var> in the <var class="zed">Session</var> state. (In
experiment mode the prescribed settings are also loaded from the
prescription database but may be changed subsequently.  In therapy
mode the counters are loaded from the prescription database when the
field is selected but may be changed subsequently.  See
section <a href="#Select Field">[sect:sel-field-f]</a>).
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">PrescribedField</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>Field </td></tr>
<tr> <td></td><td class="zed" colspan=2>Session</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>field <img width=7 height=7 alt="\neq" src="zimg/neq-m.gif"> no_field </td></tr>
<tr> <td></td><td class="zed" colspan=2>mode = therapy <img width=13 height=7 alt="\implies" src="zimg/implies-m.gif"> prescribed = fields&nbsp;field </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
When no field has been selected, prescribed settings and counters have
no values and the computed settings dose and time indicate no dose.
(8.9.7, 192, second paragraph after the bullets).  No settings are
overridden (8.9.8, 194; 8.9.9, 196; 8.9.10, 198).
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed">no_prescrip == (<img width=8 height=10 alt="\lambda" src="zimg/lambda-m.gif"> p: prescrip <img width=7 height=7 alt="@" src="zimg/spot-m.gif"> blank)</td></tr>
<tr> <td class="zed"><img width=1 height=10 align=bottom alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td class="zed">no_counter == (<img width=8 height=10 alt="\lambda" src="zimg/lambda-m.gif"> c: counter <img width=7 height=7 alt="@" src="zimg/spot-m.gif"> blank)</td></tr>
<tr> <td class="zed"><img width=1 height=10 align=bottom alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td class="zed">no_dose_reg == (<img width=8 height=10 alt="\lambda" src="zimg/lambda-m.gif"> d: dose_reg <img width=7 height=7 alt="@" src="zimg/spot-m.gif"> blank)</td></tr>
<tr> <td class="zed"><img width=1 height=10 align=bottom alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td class="zed">no_dose == { p_dose <img height=9 width=10 alt="\mapsto" src="zimg/mapsto-m.gif"> blank, p_time <img height=9 width=10 alt="\mapsto" src="zimg/mapsto-m.gif"> blank } </td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">NoFieldF</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>Field </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>prescribed = no_prescrip </td></tr>
<tr> <td></td><td class="zed" colspan=2>accumulated = no_counter </td></tr>
<tr> <td></td><td class="zed" colspan=2>no_dose <img width=9 height=10 align=absbottom alt="\subseteq" src="zimg/subseteq-m.gif"> computed </td></tr>
<tr> <td></td><td class="zed" colspan=2>overridden = <img width=11 height=11 alt="\emptyset" src="zimg/emptyset-m.gif"> </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed">NoFieldS <img height=11 width=11 alt="\defs" src="zimg/defs-m.gif"> [ Session | field = no_field ]</td></tr>
<tr> <td class="zed"><img width=1 height=10 align=bottom alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td class="zed">NoField <img height=11 width=11 alt="\defs" src="zimg/defs-m.gif"> NoFieldF <img width=8 height=7 alt="\land" src="zimg/land-m.gif"> NoFieldS</td></tr>
</table>
</div>

<p class="informal">
<var class="zed">FieldSession</var> expresses the combined invariant:
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed">FieldSession <img height=11 width=11 alt="\defs" src="zimg/defs-m.gif"> PrescribedField <img width=8 height=7 alt="\lor" src="zimg/lor-m.gif"> NoField</td></tr>
</table>
</div>


<h3><a name="Initialization">Initialization</a></h3>

<p class="informal">
<var class="zed">Field</var> begins with no field.  The calibration factors
are initialized with the constants on file (8.9.13, 213, second
paragraph after bullets) and the other registers hold no values.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">InitField</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>NoFieldF</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>computed = calibrated = no_dose_reg <img width=9 height=9 alt="\oplus" src="zimg/oplus-m.gif"> cal_factor</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>


<h3><a name="Operations on Field">Operations on Field</a></h3>

<p class="informal">
In the following subsections we model the operations on <var class="zed">Field</var>.  We
will put together the operations defined in different states in
section <a href="#Combining the subsystems">[sect:compose]</a>, below.
</p>

<h4><a name="Select Patient">Select Patient</a></h4>

<p class="informal">
<b>SelectPatient</b> also affects <var class="zed">Field</var>: when a patient is first selected,
there is no field.
</p>


<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">SelectPatientF</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=7 height=10 alt="\Delta" src="zimg/Delta-m.gif"> Field</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>NoFieldF' </td></tr>
<tr> <td></td><td class="zed" colspan=2>computed' = computed <img width=9 height=9 alt="\oplus" src="zimg/oplus-m.gif"> no_dose </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=1 height=10 align=bottom alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>calibrated' = calibrated </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>


<h4><a name="Select Field">Select Field</a></h4> 

<p class="informal">
When a new field is selected, its prescribed settings are loaded and
no settings are overridden.  This operation requires read-only access
to the <var class="zed">fields</var> state variable in the <var class="zed">Session</var> schema.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">NewFieldF</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=7 height=10 alt="\Delta" src="zimg/Delta-m.gif"> FieldSession </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>prescribed' = fields&nbsp;field' </td></tr>
<tr> <td></td><td class="zed" colspan=2>overridden' = <img width=11 height=11 alt="\emptyset" src="zimg/emptyset-m.gif"> </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
There are two variants of <var class="zed">SelectField</var>. Experiment mode is much
simpler because there is no prescribed dose.  The prescribed settings
are loaded.  The dose and time do not change (8.9.11, 202, second
paragraph from bottom).
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">SelectExptFieldF</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>NewFieldF </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>mode = experiment </td></tr>
<tr> <td></td><td class="zed" colspan=2>computed' = computed </td></tr>
<tr> <td></td><td class="zed" colspan=2>calibrated' = calibrated </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
Selecting rectangular fields in experimental mode (8.9.4, 188 -- 189)
is not modelled formally.
</p>

<p class="informal">
In therapy mode, the dose for the treatment run and the treatment
backup time are calculated.  Treatment backup time is calculated from
the dose and two calibration factors, the machine's nominal dose rate
<var class="zed">computed&nbsp;d_rate</var> and the treatment time factor <var class="zed">computed&nbsp;t_fac</var>
(8.9.11, 200, last paragraph; 202, second paragraph; 8.9.13, 213,
first two paragraphs after bullets) (The backup time is given
by <var class="zed">t_backup = factor * dose / rate</var>. For example with prescribed
dose 100.0 MU, dose rate 50.0 MU/min and factor 1.50 the backup time
is 3.00 minutes.  We do not attempt to model this floating-point
calculation in Z.).
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed">DOSE == VALUE; RATE == VALUE; FACTOR == VALUE; TIME == VALUE</td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td width=1 rowspan=99 bgcolor=black><img width=1 height=1 alt="\begin{axdef}" src="zimg/clear.gif"><br></td></tr>
<tr> <td></td><td class="zed" colspan=2>t_backup: (DOSE <img width=7 height=7 alt="\cross" src="zimg/cross-m.gif"> RATE <img width=7 height=7 alt="\cross" src="zimg/cross-m.gif"> FACTOR) <img width=14 height=8 alt="\pfun" src="zimg/pfun-m.gif"> TIME</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=9 height=10 alt="\forall" src="zimg/forall-m.gif"> d: valid&nbsp;dose; r: valid&nbsp;d_rate; f: valid&nbsp;t_fac <img width=7 height=7 alt="@" src="zimg/spot-m.gif"> </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=10 height=1 align=bottom alt="    " src="zimg/clear.gif"> (d,r,f) <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> <b>dom</b> t_backup <img width=8 height=7 alt="\land" src="zimg/land-m.gif"> t_backup(d,r,f) <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> valid&nbsp;p_time</td></tr>
<tr><td width=10 height=1><img width=10 height=1 alt="\end{axdef}" src="zimg/clear.gif"></td></tr>
</table>
</div>

<p class="informal">
We keep track of the number of monitor units delivered since the
beginning of the day <var class="zed">accumulated&nbsp;dose</var>.  When the prescribed field
settings are loaded, the computed dose is adjusted to deliver the
remaining daily dose.  This makes it easy to set up another treatment
run for the same field if the earlier attempts had to be interrupted for
any reason, or were used to make a port film.  The treatment backup time is
calculated from this adjusted dose, not the prescribed dose.
</p>

<p class="informal">
The adjusted dose and corresponding backup time are stored in
<var class="zed">computed&nbsp;p_dose</var> and <var class="zed">calibrated&nbsp;p_time</var> (<var class="zed">computed&nbsp;p_dose</var> may
differ from <var class="zed">prescribed&nbsp;dose</var>).  There is also a register
<var class="zed">computed&nbsp;p_time</var> where the user may optionally enter a backup time
different than <var class="zed">calibrated&nbsp;p_time</var> (section
<a href="#Edit setting">[sect:editf]</a>, below)
(8.9.11, Fig. 8.8, 199; Fig. 8.9, 203; Fig 8.10, 207; Fig. 8.11, 208).
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">DoseTime</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=7 height=10 alt="\Delta" src="zimg/Delta-m.gif"> Field</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>(<b>let</b> t == t_backup(computed'&nbsp;p_dose,computed'&nbsp;d_rate,computed'&nbsp;t_fac) <img width=7 height=7 alt="@" src="zimg/spot-m.gif"> </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=10 height=1 align=bottom alt="    " src="zimg/clear.gif">calibrated' = calibrated <img width=9 height=9 alt="\oplus" src="zimg/oplus-m.gif"> { &nbsp;p_time <img height=9 width=10 alt="\mapsto" src="zimg/mapsto-m.gif"> t }) </td></tr>
<tr> <td></td><td class="zed" colspan=2>computed'&nbsp;p_time = calibrated'&nbsp;p_time </td></tr>
<tr> <td></td><td class="zed" colspan=2>{ p_dose, p_time } <img height=11 width=10  alt="\ndres" src="zimg/ndres-m.gif"> computed' = { p_dose, p_time } <img height=11 width=10  alt="\ndres" src="zimg/ndres-m.gif"> computed</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">NewTherapyField</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>NewFieldF </td></tr>
<tr> <td></td><td class="zed" colspan=2>DoseTime </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>mode = therapy </td></tr>
<tr> <td></td><td class="zed" colspan=2>accumulated' = counters&nbsp;field'  </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
There are two cases.  The normal case occurs when the user interface
confirms that the prescribed fractional
dose, total dose and number of fractions are not yet <var class="zed">exceeded</var>. The
dose is read from the prescription, and no
settings are overridden (8.9.4, 187).
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">SelectTherapyFieldF</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>NewTherapyField </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>computed'&nbsp;p_dose = prescribed&nbsp;dose - accumulated&nbsp;dose </td></tr>
<tr> <td></td><td class="zed" colspan=2>overridden' = <img width=11 height=11 alt="\emptyset" src="zimg/emptyset-m.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
Together these make the simple case
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed">SelectSimpleFieldF <img height=11 width=11 alt="\defs" src="zimg/defs-m.gif"> SelectExptFieldF <img width=8 height=7 alt="\lor" src="zimg/lor-m.gif"> SelectTherapyFieldF</td></tr>
</table>
</div>

<p class="informal">
The other case occurs when the user interface acquires the preset dose
from the operator (often when one or more of the counter settings is
<var class="zed">exceeded</var>.  If this differs from the prescribed dose then dose is
overridden, and any exceeded settings are also overridden (8.9.4,
188).
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">SelectComplexFieldF</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>NewTherapyField </td></tr>
<tr> <td></td><td class="zed" colspan=2>dose?: VALUE</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>computed'&nbsp;p_dose = dose? </td></tr>
<tr> <td></td><td class="zed" colspan=2>(<b>let</b> ovr == </td></tr>
<tr> <td></td><td class="zed" colspan=2> (<img width=8 height=10 alt="\lambda" src="zimg/lambda-m.gif"> c: counter | accumulated'&nbsp;c <img width=7 height=9 alt="\geq" src="zimg/geq-m.gif"> prescribed'&nbsp;c <img width=7 height=7 alt="@" src="zimg/spot-m.gif"> accumulated&nbsp;c) <img width=7 height=7 alt="@" src="zimg/spot-m.gif"> </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=10 height=1 align=bottom alt="    " src="zimg/clear.gif">  overridden' = <b>if</b> dose? = prescribed'&nbsp;dose </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=50 height=1 align=bottom alt="    " src="zimg/clear.gif"><b>then</b> ovr <b>else</b> ovr <img width=10 height=7 alt="\cup" src="zimg/cup-m.gif"> { dose <img height=9 width=10 alt="\mapsto" src="zimg/mapsto-m.gif"> dose? })</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
Here we have made a few small changes from the prose requirements.
According to the prose (8.9.4, 187 -- 188), the <b>Select Field</b>
operation includes a dialog with the operator to enter a new dose or
treatment time in some cases.  In our formal specification it is
necessary for the operator to explicitly select the <b>Edit</b>
operation after <b>Select Field</b> in order to enter a new dose or
treatment time.  These minor adjustments achieve the intent of the
prose and simplify the program.  As required by the prose, our
<var class="zed">SelectComplexFieldF</var> overrides exceeded settings (after operator
confirmation, enforced by the user interface) (We also
considered the slightly simpler alternative of omitting the operator
confirmation and leaving <var class="zed">overridden = <img width=11 height=11 alt="\emptyset" src="zimg/emptyset-m.gif"></var> in the <var class="zed">exceeded</var>
case.  In that alternative, the <var class="zed">Intlk</var> subsystem
(section <a href="#Software interlocks and status flags">[sect:intlk]</a>) would make the offending settings
<var class="zed">not_ready</var> to prevent the field being delivered unless the operator
explicitly edits or overrides those settings.).
</p>

<h4><a name="Edit setting">Edit setting</a></h4>  

<p class="informal">
The edit operation updates a <var class="zed">prescribed</var> or <var class="zed">computed</var> item value.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">EditF</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=7 height=10 alt="\Delta" src="zimg/Delta-m.gif"> Field </td></tr>
<tr> <td></td><td class="zed" colspan=2>item?: ITEM </td></tr>
<tr> <td></td><td class="zed" colspan=2>value?: VALUE </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>accumulated' = accumulated </td></tr>
<tr> <td></td><td class="zed" colspan=2>calibrated' = calibrated</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
The prose actually describes four <b>Edit</b> operations.  Some
features are common to all.  The first variation is for preset
settings; the user interface ensures this can be invoked in experiment
mode only (8.8.1, 180).  The prescribed value is changed, and that
setting is no longer overridden.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">EditPresetF</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>EditF</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>item? <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> preset </td></tr>
<tr> <td></td><td class="zed" colspan=2>prescribed' = prescribed <img width=9 height=9 alt="\oplus" src="zimg/oplus-m.gif"> { item? <img height=9 width=10 alt="\mapsto" src="zimg/mapsto-m.gif"> value? } </td></tr>
<tr> <td></td><td class="zed" colspan=2>overridden' = { item? } <img height=11 width=10  alt="\ndres" src="zimg/ndres-m.gif"> overridden </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=1 height=10 align=bottom alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>computed' = computed </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
The second variation is for calibration factors; again, the user
interface only provides this in experiment mode
(8.9.3, 215).  Calibration factors that users can edit are
modelled as <var class="zed">computed</var> settings in <var class="zed">registers</var>.  Calibration factors
are never considered overridden.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">EditCalF</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>EditF</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>item? <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> dose_reg \ { p_dose, p_time } </td></tr>
<tr> <td></td><td class="zed" colspan=2>computed' = computed <img width=9 height=9 alt="\oplus" src="zimg/oplus-m.gif"> { item? <img height=9 width=10 alt="\mapsto" src="zimg/mapsto-m.gif"> value? } </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=1 height=10 align=bottom alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>prescribed' = prescribed </td></tr>
<tr> <td></td><td class="zed" colspan=2>overridden' = overridden</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
The third variation is for dose (8.9.11, 201--202). The computed (not
prescribed) value is changed, and the dose is considered overridden
(8.9.4, 188; 8.9.11, 202).  The treatment times are recalculated.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">EditDoseF</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>EditF </td></tr>
<tr> <td></td><td class="zed" colspan=2>DoseTime </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>item? = p_dose </td></tr>
<tr> <td></td><td class="zed" colspan=2>computed'&nbsp;p_dose = value? </td></tr>
<tr> <td></td><td class="zed" colspan=2>overridden' = overridden <img width=9 height=9 alt="\oplus" src="zimg/oplus-m.gif"> { dose <img height=9 width=10 alt="\mapsto" src="zimg/mapsto-m.gif"> value? } </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=1 height=10 align=bottom alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>prescribed' = prescribed </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
The fourth and last variation is treatment backup time, which can be
edited in both modes (8.9.11, 202). Here again the computed value is
changed; time is not a prescribed setting, so it cannot be
overridden.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">EditTimeF</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>EditF</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>item? = p_time </td></tr>
<tr> <td></td><td class="zed" colspan=2>computed' = computed <img width=9 height=9 alt="\oplus" src="zimg/oplus-m.gif"> { p_time <img height=9 width=10 alt="\mapsto" src="zimg/mapsto-m.gif"> value? } </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=1 height=10 align=bottom alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>prescribed' = prescribed </td></tr>
<tr> <td></td><td class="zed" colspan=2>overridden' = overridden </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
Here is the combined operation:
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed">EditSettingF <img height=11 width=11 alt="\defs" src="zimg/defs-m.gif"> </td></tr>
<tr> <td class="zed"> EditCalF <img width=8 height=7 alt="\lor" src="zimg/lor-m.gif"> EditPresetF <img width=8 height=7 alt="\lor" src="zimg/lor-m.gif"> EditDoseF <img width=8 height=7 alt="\lor" src="zimg/lor-m.gif"> EditTimeF</td></tr>
</table>
</div>

<p class="informal">
<var class="zed">EditSettingF</var> is not a total operation (it does not handle all
possible values of <var class="zed">ITEM</var>) but the user interface ensures that
its preconditions are always satisfied.
</p>

<p class="informal">
We now provide the <var class="zed">EditDoseF</var> and <var class="zed">EditTimeF</var> operations instead of
the dialog after <b>Select Field</b> proposed in
<a href="ftp://ftp.radonc.washington.edu:/pub/cnts-reports/spec2">[jacky92]</a>
(8.9.4, 187 -- 188).
</p>

<h4><a name="Override">Override</a></h4>

<p class="informal">
Certain items can be overridden.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">OverF</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=7 height=10 alt="\Delta" src="zimg/Delta-m.gif"> Field </td></tr>
<tr> <td></td><td class="zed" colspan=2>item?: ITEM </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>prescribed' = prescribed </td></tr>
<tr> <td></td><td class="zed" colspan=2>accumulated' = accumulated </td></tr>
<tr> <td></td><td class="zed" colspan=2>computed' = computed </td></tr>
<tr> <td></td><td class="zed" colspan=2>calibrated' = calibrated</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
We add a newly overridden setting and its currently measured value
to the <var class="zed">overridden</var> function (8.4, 175 second paragraph; 8.8.1, 181).
If the setting is already overridden, the override is cancelled.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">OverrideSetting</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>OverF</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>item? <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> prescr </td></tr>
<tr> <td></td><td class="zed" colspan=2>overridden' = </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=10 height=1 align=bottom alt="    " src="zimg/clear.gif"> <b>if</b> item? <img width=7 height=11 align=absbottom alt="\notin" src="zimg/notin-m.gif"> <b>dom</b> overridden </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=20 height=1 align=bottom alt="    " src="zimg/clear.gif"><b>then</b> overridden <img width=9 height=9 alt="\oplus" src="zimg/oplus-m.gif"> { item? <img height=9 width=10 alt="\mapsto" src="zimg/mapsto-m.gif"> measured&nbsp;item? } </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=20 height=1 align=bottom alt="    " src="zimg/clear.gif"><b>else</b> { item? } <img height=11 width=10  alt="\ndres" src="zimg/ndres-m.gif"> overridden</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
Dose and time are special cases; overriding either makes dose
overridden with its accumulated (not measured) value as
the overridden value.  The counters 
total dose <var class="zed">dose_tot</var> and number of fractions
<var class="zed">nfrac</var> can only be overridden (after operator confirmation) as part
of the <var class="zed">SelectFieldF</var> operation.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">OverrideDose</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>OverF</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>item? <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> { p_dose, p_time } </td></tr>
<tr> <td></td><td class="zed" colspan=2>overridden' = </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=10 height=1 align=bottom alt="    " src="zimg/clear.gif"> <b>if</b> dose <img width=7 height=11 align=absbottom alt="\notin" src="zimg/notin-m.gif"> <b>dom</b> overridden </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=20 height=1 align=bottom alt="    " src="zimg/clear.gif"><b>then</b> overridden <img width=9 height=9 alt="\oplus" src="zimg/oplus-m.gif"> { dose <img height=9 width=10 alt="\mapsto" src="zimg/mapsto-m.gif"> accumulated&nbsp;dose } </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=20 height=1 align=bottom alt="    " src="zimg/clear.gif"><b>else</b> { dose } <img height=11 width=10  alt="\ndres" src="zimg/ndres-m.gif"> overridden</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed"> OverrideF <img height=11 width=11 alt="\defs" src="zimg/defs-m.gif"> OverrideSetting <img width=8 height=7 alt="\lor" src="zimg/lor-m.gif"> OverrideDose </td></tr>
</table>
</div>


<h4><a name="Store Field">Store Field</a></h4>

<p class="informal">
This operation (8.9.5, 189 -- 190) makes the prescribed settings equal
to the actual machine settings, except there is no prescribed dose and
the number of fractions is set to one.  The accumulators are reset to
zero.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed">zero_counter == (<img width=8 height=10 alt="\lambda" src="zimg/lambda-m.gif"> c: counter <img width=7 height=7 alt="@" src="zimg/spot-m.gif"> 0)</td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">StoreFieldF</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=7 height=10 alt="\Delta" src="zimg/Delta-m.gif"> FieldSession </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>computed' = computed <img width=9 height=9 alt="\oplus" src="zimg/oplus-m.gif"> no_dose </td></tr>
<tr> <td></td><td class="zed" colspan=2>prescribed' = prescribed <img width=9 height=9 alt="\oplus" src="zimg/oplus-m.gif">  (prescrip <img height=11 width=10 alt="\dres" src="zimg/dres-m.gif"> measured) </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=9 height=9 alt="\oplus" src="zimg/oplus-m.gif"> no_counter <img width=9 height=9 alt="\oplus" src="zimg/oplus-m.gif"> { nfrac <img height=9 width=10 alt="\mapsto" src="zimg/mapsto-m.gif"> 1 } </td></tr>
<tr> <td></td><td class="zed" colspan=2>accumulated' = zero_counter </td></tr>
<tr> <td></td><td class="zed" colspan=2>overridden' = <img width=11 height=11 alt="\emptyset" src="zimg/emptyset-m.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=1 height=10 align=bottom alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>calibrated' = calibrated </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>



<h4><a name="Experiment Mode">Experiment Mode</a></h4>

<p class="informal">
This operation toggles modes with no field.  There are
no dose and time (8.9.11, 202, second paragraph from bottom).
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">ExptModeF</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=7 height=10 alt="\Delta" src="zimg/Delta-m.gif"> Field</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>NoFieldF' </td></tr>
<tr> <td></td><td class="zed" colspan=2>computed' = computed <img width=9 height=9 alt="\oplus" src="zimg/oplus-m.gif"> no_dose</td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=1 height=10 align=bottom alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>calibrated' = calibrated</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>


<h3><a name="Calibration factors">Calibration factors</a></h3>

<h4><a name="Dosimetry calibration">Dosimetry calibration</a></h4>

<p class="informal">
Dosimetry calibration factors, including the dose rate and treatment
time factor used to calculate the backup time, appear on the 
<b>Dosimetry Calibration</b> display (8.9.13, 213 -- 214) (Called
<b>Cal Factors</b> in <a href="ftp://ftp.radonc.washington.edu:/pub/cnts-reports/spec2">[jacky92]</a>, since renamed to distinguish it
from the forthcoming <b>LCC Calibration</b> etc.).
The <var class="zed">calibrated</var> values in the left column are read from
files or measured by sensors, while the <var class="zed">computed</var> values in the right
column are computed by the control program or entered by the operator
using the <var class="zed">EditCalF</var> operation.
</p>

<p class="informal">
The pressure-temperature correction factors are used to adjust the
standard calibration voltages for the dosimetry system (8.9.13, 213 --
215).  The <var class="zed">calibrated&nbsp;calvolt1</var> and <var class="zed">calibrated&nbsp;calvolt2</var> represent
the standard calibration voltages on file (8.9.13, 213, second
paragraph from bottom), while <var class="zed">computed&nbsp;calvolt1</var> (etc.) represent the
calibration voltages actually in effect, which are obtained by
adusting the standard calibration voltage by a barometric
pressure/temperature correction factor (8.9.13, 213 bottom paragraph,
214 top paragraph) (The pressure-temperature factor is given
by <var class="zed">pt_factor = (press/1013) \times (295/(temp+273))</var>, where <var class="zed">press</var>
and <var class="zed">temp</var> are in mbar and deg. C, respectively. We do not attempt to
model this floating-point calculation in Z.).
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed"> PRESSURE == VALUE; TEMPERATURE == VALUE </td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td width=1 rowspan=99 bgcolor=black><img width=1 height=1 alt="\begin{axdef}" src="zimg/clear.gif"><br></td></tr>
<tr> <td></td><td class="zed" colspan=2>pt_formula: (PRESSURE <img width=7 height=7 alt="\cross" src="zimg/cross-m.gif"> TEMPERATURE) <img width=14 height=8 alt="\pfun" src="zimg/pfun-m.gif"> FACTOR</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=9 height=10 alt="\forall" src="zimg/forall-m.gif"> p: valid&nbsp;press; t: valid&nbsp;temp <img width=7 height=7 alt="@" src="zimg/spot-m.gif"> </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=10 height=1 align=bottom alt="    " src="zimg/clear.gif"> (p,t) <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> <b>dom</b> pt_formula <img width=8 height=7 alt="\land" src="zimg/land-m.gif"> pt_formula(p,t) <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> valid&nbsp;pt_factor</td></tr>
<tr><td width=10 height=1><img width=10 height=1 alt="\end{axdef}" src="zimg/clear.gif"></td></tr>
</table>
</div>

<p class="informal">
The <var class="zed">computed&nbsp;press</var> and <var class="zed">computed&nbsp;temp</var> are the pressure and
temperature entered by the operator, and while <var class="zed">calibrated&nbsp;temp</var> and
<var class="zed">calibrated&nbsp;press</var> are measured continously by sensors. The
<var class="zed">computed&nbsp;pt_factor</var> stores the 
<em>barometric pressure/temperature correction factor of the day</em> 
calculated from the readings entered by
the operator (8.9.13, 214, third paragraph), while
<var class="zed">calibrated&nbsp;pt_factor</var> stores the 
<em>automatic pressure/temperature correction factor</em> 
calculated from sensor readings (8.9.13, 214,
fourth paragraph).  The <em>pressure-temperature</em> interlock
(section <a href="#Software interlocks and status flags">[sect:intlk]</a>) accounts for the possibility that the
pressure or temperature values might be invalid or expired.
</p>

<p class="informal">
The operator sets <var class="zed">computed&nbsp;pt_mode = automatic</var> to use the 
<em>automatic pressure/temperature correction factor</em>, 
and <var class="zed">computed&nbsp;pt_mode = manual</var> to
use the correction factor that is based on the manually entered values (8.9.13,
214, fifth paragraph).
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td width=1 rowspan=99 bgcolor=black><img width=1 height=1 alt="\begin{axdef}" src="zimg/clear.gif"><br></td></tr>
<tr> <td></td><td class="zed" colspan=2>automatic, manual: VALUE </td></tr>
<tr><td width=10 height=1><img width=10 height=1 alt="\end{axdef}" src="zimg/clear.gif"></td></tr>
</table>
</div>

<p class="informal">
The <var class="zed">ScanPT</var> operation computes the correction factors and updates
the registers with the new values.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">ScanPT</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=7 height=10 alt="\Delta" src="zimg/Delta-m.gif"> Field</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>calibrated'&nbsp;pt_factor = pt_formula(calibrated&nbsp;press,calibrated&nbsp;temp)</td></tr>
<tr> <td></td><td class="zed" colspan=2>computed'&nbsp;pt_factor = pt_formula(computed&nbsp;press,computed&nbsp;temp) </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=1 height=10 align=bottom alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>(<b>let</b> pt_corr == <b>if</b> computed&nbsp;pt_mode = automatic   </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=50 height=1 align=bottom alt="    " src="zimg/clear.gif"><b>then</b> calibrated'&nbsp;pt_factor <b>else</b> computed'&nbsp;pt_factor <img width=7 height=7 alt="@" src="zimg/spot-m.gif"> </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=10 height=1 align=bottom alt="    " src="zimg/clear.gif">computed'&nbsp;calvolt1 = pt_corr * calibrated&nbsp;calvolt1 <img width=8 height=7 alt="\land" src="zimg/land-m.gif"> </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=10 height=1 align=bottom alt="    " src="zimg/clear.gif">computed'&nbsp;calvolt2 = pt_corr * calibrated&nbsp;calvolt2) </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=1 height=10 align=bottom alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>{ pt_factor } <img height=11 width=10  alt="\ndres" src="zimg/ndres-m.gif"> calibrated' = { pt_factor } <img height=11 width=10  alt="\ndres" src="zimg/ndres-m.gif"> calibrated </td></tr>
<tr> <td></td><td class="zed" colspan=2>{ pt_factor, calvolt1, calvolt2 } <img height=11 width=10  alt="\ndres" src="zimg/ndres-m.gif"> computed' = { pt_factor, calvolt1, calvolt2 } <img height=11 width=10  alt="\ndres" src="zimg/ndres-m.gif"> computed </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=1 height=10 align=bottom alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>prescribed' = prescribed </td></tr>
<tr> <td></td><td class="zed" colspan=2>accumulated' = accumulated </td></tr>
<tr> <td></td><td class="zed" colspan=2>overridden' = overridden</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
<var class="zed">ScanPT</var> is scheduled by the control program itself; it is not invoked
by the user.
</p>

<h2><a name="Software interlocks and status flags">Software interlocks and status flags</a></h2> 

<p class="informal">
(See the
<a href="ftp://ftp.radonc.washington.edu:/pub/cnts-reports/z">full report</a>.)
</p>


<h2><a name="User interface">User interface</a></h2> 

<p class="informal">
The user may provide input at the workstation at any time (by typing,
pressing function keys or cursor arrow keys --- in our implementation
we do not use the mouse).  We model each keystroke and the actions
it invokes as an <var class="zed">Event</var> that accepts an <var class="zed">input?</var> that may change the
<var class="zed">Console</var> state.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">Event</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=7 height=10 alt="\Delta" src="zimg/Delta-m.gif"> Console </td></tr>
<tr> <td></td><td class="zed" colspan=2>input?: INPUT</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
We do not attempt to formalize any ``look and feel'' aspects of the
user interface, such as the appearance of the display.  They are
already described in sufficient detail in <a href="ftp://ftp.radonc.washington.edu:/pub/cnts-reports/spec2">[jacky92]</a>, chapters 2
and 8.
</p>

<p class="informal">
<var class="zed">INPUT</var> is the set of inputs (keypresses) the user can
provide (In the implementation, inputs are X window system
events and the values of <var class="zed">INPUT</var> correspond to X
keysyms&nbsp;[nye88].).  Here is the list of inputs at this writing.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0> 
<tr> <td class="zed">INPUT ::= filter_wedge | leaf_collim | dose_intlk | gantry_psa | dose_cal | </td></tr>
<tr> <td class="zed"><img width=30 height=1 align=bottom alt="    " src="zimg/clear.gif">startup | help | messages | select_patient | select_field | field_summary | </td></tr>
<tr> <td class="zed"><img width=30 height=1 align=bottom alt="    " src="zimg/clear.gif">login | edit_setting | edit_dose_reg | log_message | store_field | override_cmd | </td></tr>
<tr> <td class="zed"><img width=30 height=1 align=bottom alt="    " src="zimg/clear.gif">cancel_run | password |auto_setup | expt_mode | cancel | refresh | shutdown | </td></tr>
<tr> <td class="zed"><img width=30 height=1 align=bottom alt="    " src="zimg/clear.gif"> select | ret | character | backspace | delete_key |  </td></tr>
<tr> <td class="zed"><img width=30 height=1 align=bottom alt="    " src="zimg/clear.gif">left_arrow | right_arrow | up_arrow | down_arrow | ignored</td></tr>
</table>
</div>

<p class="informal">
Many operations are invoked by pressing keys, so it is often
convenient to identify operations with the corresponding input.
Therefore we assign them to the same type.   Here is the list of 
operations at this writing.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td width=1 rowspan=99 bgcolor=black><img width=1 height=1 alt="\begin{axdef}" src="zimg/clear.gif"><br></td></tr>
<tr> <td></td><td class="zed" colspan=2>OP: <img height=11 width=9 alt="\power" src="zimg/power-m.gif"> INPUT</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>OP = { filter_wedge, leaf_collim, dose_intlk, gantry_psa, dose_cal, </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=20 height=1 align=bottom alt="    " src="zimg/clear.gif"> startup, help, messages, select_patient, select_field, field_summary, </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=20 height=1 align=bottom alt="    " src="zimg/clear.gif"> login, edit_setting, edit_dose_reg, log_message, store_field, override_cmd, </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=20 height=1 align=bottom alt="    " src="zimg/clear.gif"> cancel_run, password,auto_setup, expt_mode, cancel, refresh, shutdown, select )</td></tr>
<tr><td width=10 height=1><img width=10 height=1 alt="\end{axdef}" src="zimg/clear.gif"></td></tr>
</table>
</div>

<p class="informal">
The user interface shows many displays, for example the login display
(Fig 8.1, 178), the patient list display (Fig. 8.2, 185), the leaf
collimator display (Fig. 8.7, 197) etc.  The operator can choose any
display by pressing a key, so we can identify displays with these
operations.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td width=1 rowspan=99 bgcolor=black><img width=1 height=1 alt="\begin{axdef}" src="zimg/clear.gif"><br></td></tr>
<tr> <td></td><td class="zed" colspan=2>DISPLAY: <img height=11 width=9 alt="\power" src="zimg/power-m.gif"> OP</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>DISPLAY = { filter_wedge, leaf_collim, dose_intlk, gantry_psa, dose_cal, </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=30 height=1 align=bottom alt="    " src="zimg/clear.gif">startup, help, messages, select_patient, select_field, </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=30 height=1 align=bottom alt="    " src="zimg/clear.gif">field_summary, login )</td></tr>
<tr><td width=10 height=1><img width=10 height=1 alt="\end{axdef}" src="zimg/clear.gif"></td></tr>
</table>
</div>


<h3><a name="Console state">Console state</a></h3>

<p class="informal">
This section describes the variables in the <var class="zed">Console</var> state.  
</p>

<p class="informal">
The first variable indicates the mode of <var class="zed">interaction</var>.  If no
interaction is in progress the console is <var class="zed">available</var>, or there
may be a <var class="zed">dialog</var> in progress where the user is typing text into a
dialog box, or there may be a <var class="zed">menu</var> displayed, or the user may be
asked to <var class="zed">confirm</var> some operation by providing a yes/no answer (this
mode can also be used to present informational messages).
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed">INTERACTION ::= available | dialog | menu | confirm</td></tr>
</table>
</div>

<p class="informal">
The <var class="zed">op</var> variable keeps track of which top-level operation
(described in <a href="ftp://ftp.radonc.washington.edu:/pub/cnts-reports/spec2">[jacky92]</a>) is underway.
</p>

<p class="informal">
The <var class="zed">display</var> variable indicates which of the screen designs pictured
in the informal specification is currently visible on the display.
The <var class="zed">display</var> variable determines which items appear and helps
determine which operations are available.  
</p>

<p class="informal">
The <var class="zed">item</var> state variable holds the item which the operator has
selected from a tabular display, for example the setting which
the operator is editing.
</p>

<p class="informal">
The <var class="zed">nlist</var> state variable holds the list of names (of patients or
fields) that appear on a list display, and <var class="zed">list_item</var> indicates 
the currently selected name.
</p>

<p class="informal">
The <var class="zed">menu_item</var> state variable holds the index of the current menu
selection (a small integer).
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td width=1 rowspan=99 bgcolor=black><img width=1 height=1 alt="\begin{axdef}" src="zimg/clear.gif"><br></td></tr>
<tr> <td></td><td class="zed" colspan=2>nmax: <img height=11 width=10 alt="\nat" src="zimg/nat-m.gif"></td></tr>
<tr><td width=10 height=1><img width=10 height=1 alt="\end{axdef}" src="zimg/clear.gif"></td></tr>
</table>
</div>

<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed"> SELECTION == { i: <img height=11 width=10 alt="\nat" src="zimg/nat-m.gif"> | i <img width=7 height=9 alt="\leq" src="zimg/leq-m.gif"> nmax } </td></tr>
</table>
</div>

<p class="informal">
The <var class="zed">buffer</var> state variable models the (possibly incomplete) string
that the user edits in dialog mode.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed">[STRING]</td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td width=1 rowspan=99 bgcolor=black><img width=1 height=1 alt="\begin{axdef}" src="zimg/clear.gif"><br></td></tr>
<tr> <td></td><td class="zed" colspan=2>empty: STRING</td></tr>
<tr><td width=10 height=1><img width=10 height=1 alt="\end{axdef}" src="zimg/clear.gif"></td></tr>
</table>
</div>

<p class="informal">
The <var class="zed">keyswitch</var> must be unlocked to allow the console to be used (8.7, 179).
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed">KEYSWITCH ::= locked | unlocked</td></tr>
</table>
</div>

<p class="informal">
Some operations are available only when a treatment is being set up,
and are locked out while a treatment <var class="zed">run</var> is in progress (8.8.2, 183).
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed">RUN ::= setup | running</td></tr>
</table>
</div>

<p class="informal">
The <var class="zed">keyswitch</var> and <var class="zed">run</var> variables depend on sensor inputs; they are not
constrained here.
</p>

<p class="informal">
Together, these variables describe the state of the user interaction.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">Console</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>keyswitch: KEYSWITCH </td></tr>
<tr> <td></td><td class="zed" colspan=2>run: RUN </td></tr>
<tr> <td></td><td class="zed" colspan=2>display: DISPLAY </td></tr>
<tr> <td></td><td class="zed" colspan=2>op: OP </td></tr>
<tr> <td></td><td class="zed" colspan=2>interaction: INTERACTION </td></tr>
<tr> <td></td><td class="zed" colspan=2>item: ITEM </td></tr>
<tr> <td></td><td class="zed" colspan=2>nlist: <img height=11 width=9 alt="\power" src="zimg/power-m.gif"> NAME </td></tr>
<tr> <td></td><td class="zed" colspan=2>list_item: NAME </td></tr>
<tr> <td></td><td class="zed" colspan=2>menu_item: SELECTION </td></tr>
<tr> <td></td><td class="zed" colspan=2>buffer: STRING</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
When the control program starts up, the login process begins
(section <a href="#Logout and login">[sect:login-console]</a>) 
(When the implementation
starts up, the <var class="zed">startup</var> screen appears first.  The login process does
not begin until the various <var class="zed">Init...</var> conditions are established.
We do not model this formally.).
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">InitConsole</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>Console</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>op = login </td></tr>
<tr> <td></td><td class="zed" colspan=2>display = login </td></tr>
<tr> <td></td><td class="zed" colspan=2>interaction = dialog </td></tr>
<tr> <td></td><td class="zed" colspan=2>buffer = empty</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>


<h3><a name="Elements of user interaction">Elements of user interaction</a></h3> 

<p class="informal">
All user interactions are built up from a few elements. In this
section we define the constants, states and operations that serve as
building blocks.
</p>

<p class="informal">
The <em>caption</em> type models messages or other output to the operator
that appear temporarily at the console (in dialog boxes or perhaps
even from the speaker, see 2.2.3, 9).  Captions are distinguished from
<em>log messages</em> which appear in a different location on the console
and are also stored in log files along with timestamps other
information (2.2.4, 9).
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed">[CAPTION, MESSAGE]</td></tr>
</table>
</div>

<p class="informal">
<var class="zed">Ignore</var> is the default do-nothing operation that is
invoked when a key is pressed but the preconditions for the associated
operation are not satisfied.  <var class="zed">Ignore</var> does not change the state, but
issues an alert (such as sounding the workstation bell) to notify the
user that the input was received but the operation is not enabled.  
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td width=1 rowspan=99 bgcolor=black><img width=1 height=1 alt="\begin{axdef}" src="zimg/clear.gif"><br></td></tr>
<tr> <td width=10></td><td class="zed"> alert: CAPTION </td></tr>
<tr><td><img width=1 height=1 alt="\end{axdef}" src="zimg/clear.gif"></td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">Ignore</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>Event </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=9 height=10 alt="\Xi" src="zimg/Xi-m.gif"> Console </td></tr>
<tr> <td></td><td class="zed" colspan=2>caption!: CAPTION</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>caption! = alert</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
The keyswitch must be unlocked for any operation to occur.  When the keyswitch is
locked, input is ignored:
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed">Unlocked <img height=11 width=11 alt="\defs" src="zimg/defs-m.gif"> [&nbsp; Console | keyswitch = unlocked &nbsp;]</td></tr>
<tr> <td class="zed"><img width=1 height=10 align=bottom alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td class="zed">EventUnlocked <img height=11 width=11 alt="\defs" src="zimg/defs-m.gif"> Event <img width=8 height=7 alt="\land" src="zimg/land-m.gif"> Unlocked</td></tr>
</table>
</div>

<p class="informal">
Many operations are invoked by pressing the <var class="zed">select</var> key.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0> 
<tr> <td class="zed">Select <img height=11 width=11 alt="\defs" src="zimg/defs-m.gif"> [&nbsp; EventUnlocked | input? = select &nbsp;]</td></tr>
</table>
</div>

<p class="informal">
It is convenient to describe the operations that can occur in each of
the interaction modes.  Each mode is described in a following
subsection.
</p>

<h4><a name="Available">Available</a></h4>

<p class="informal">
Most of the top-level operations described in <a href="ftp://ftp.radonc.washington.edu:/pub/cnts-reports/spec2">[jacky92]</a>
can only be selected when the console is available.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed"> Available <img height=11 width=11 alt="\defs" src="zimg/defs-m.gif"> [&nbsp; Console | interaction = available &nbsp;] </td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">Op</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>EventUnlocked</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>Available </td></tr>
<tr> <td></td><td class="zed" colspan=2>input? <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> OP </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
Certain operations have stronger preconditions: they cannot occur when
a run is in progress (8.8.2, 183).  A few operations occur only when a
run is in progress (8.9.11, 209-210). 
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed">Setup <img height=11 width=11 alt="\defs" src="zimg/defs-m.gif"> [&nbsp; Available | run = setup &nbsp;]</td></tr>
<tr> <td class="zed"><img width=1 height=10 align=bottom alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td class="zed">Running <img height=11 width=11 alt="\defs" src="zimg/defs-m.gif"> [&nbsp; Available | run = running &nbsp;]</td></tr>
</table>
</div>

<p class="informal">
When the console is available, the user may select a new <var class="zed">display</var>.
The console remains available.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">SelectDisplay</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>Op </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>input? <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> DISPLAY </td></tr>
<tr> <td></td><td class="zed" colspan=2>display' = input?  </td></tr>
<tr> <td></td><td class="zed" colspan=2>op' = display' </td></tr>
<tr> <td></td><td class="zed" colspan=2>Available' </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
<var class="zed">SelectDisplay</var> operations may change <var class="zed">item</var> and <var class="zed">list_item</var> (see
below) but do not change other state variables (for brevity we omit
the <var class="zed">x' = x</var> ``nothing changes'' predicates).
</p>

<p class="informal">
When an interaction is in progress, the console is <var class="zed">Engaged</var>.
The <var class="zed">Done</var> operation schema describes what happens when an interaction
completes: the console returns to the <var class="zed">Available</var> state, and <var class="zed">op</var>
returns to its value when the display was selected.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed"> Engaged <img height=11 width=11 alt="\defs" src="zimg/defs-m.gif"> [ Console | interaction <img width=7 height=7 alt="\neq" src="zimg/neq-m.gif"> available ] </td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">Done</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>EventUnlocked </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>Engaged </td></tr>
<tr> <td></td><td class="zed" colspan=2>op' = display </td></tr>
<tr> <td></td><td class="zed" colspan=2>display' = display </td></tr>
<tr> <td></td><td class="zed" colspan=2>Available'</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>


<p class="informal">
The <var class="zed">Cancel</var> operation is used to end an interaction without making
permanent changes to the underlying machine state.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed"> Cancel <img height=11 width=11 alt="\defs" src="zimg/defs-m.gif"> [ Done | input? = cancel ] </td></tr>
</table>
</div>


<h4><a name="Lists">Lists</a></h4>

<p class="informal">
Certain displays show a list of names (patients or fields).  When a
list display is selected, <var class="zed">nlist</var> is loaded, and the default <var class="zed">list_item</var>
is assigned. If the list is not empty, the <var class="zed">List</var> state results (the
patient list might be empty if there are no patients on file; the
field list is always empty when there is no patient, and may be empty
if there are no fields on file for the selected patient).
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td width=1 rowspan=99 bgcolor=black><img width=1 height=1 alt="\begin{axdef}" src="zimg/clear.gif"><br></td></tr>
<tr> <td></td><td class="zed" colspan=2>list: <img height=11 width=9 alt="\power" src="zimg/power-m.gif"> DISPLAY </td></tr>
<tr> <td></td><td class="zed" colspan=2>default_name: <img height=11 width=9 alt="\power" src="zimg/power-m.gif"><sub><font size=-3>1</font></sub> NAME <img width=14 height=8 alt="\fun" src="zimg/fun-m.gif"> NAME </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr> 
<tr> <td></td><td class="zed" colspan=2><img width=9 height=10 alt="\forall" src="zimg/forall-m.gif"> list: <img height=11 width=9 alt="\power" src="zimg/power-m.gif"><sub><font size=-3>1</font></sub> NAME <img width=7 height=7 alt="@" src="zimg/spot-m.gif"> default_name&nbsp;list <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> list</td></tr>
<tr><td width=10 height=1><img width=10 height=1 alt="\end{axdef}" src="zimg/clear.gif"></td></tr>
</table>
</div>



<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0> 
<tr> <td class="zed">List <img height=11 width=11 alt="\defs" src="zimg/defs-m.gif"> [&nbsp; Available | display <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> list <img width=8 height=7 alt="\land" src="zimg/land-m.gif"> nlist <img width=7 height=7 alt="\neq" src="zimg/neq-m.gif"> <img width=11 height=11 alt="\emptyset" src="zimg/emptyset-m.gif"> <img width=8 height=7 alt="\land" src="zimg/land-m.gif"> list_item <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> nlist &nbsp;]</td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">SelectList</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>SelectDisplay</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>input? <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> list </td></tr>
<tr> <td></td><td class="zed" colspan=2>((nlist = <img width=11 height=11 alt="\emptyset" src="zimg/emptyset-m.gif"> <img width=8 height=7 alt="\land" src="zimg/land-m.gif"> list_item' = no_name) </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=8 height=7 alt="\lor" src="zimg/lor-m.gif"> (List' <img width=8 height=7 alt="\land" src="zimg/land-m.gif"> list_item' = default_name&nbsp;nlist'))</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
Here <var class="zed">display <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> list <img width=8 height=7 alt="\land" src="zimg/land-m.gif"> nlist <img width=7 height=7 alt="\neq" src="zimg/neq-m.gif"> <img width=11 height=11 alt="\emptyset" src="zimg/emptyset-m.gif"></var> distinguishes the
<var class="zed">List</var> state, and this test occurs explicitly in the implementation.
In contrast, <var class="zed">list_item <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> nlist</var> is an invariant.  It need not be
coded as an explicit test but it must be maintained or else the
implementation might abort (because <var class="zed">list_item</var> is used as an index
into <var class="zed">nlist</var>).
</p>

<p class="informal">
The console indicates <var class="zed">list_item</var> (for example by placing a highlight
or cursor over that name in the list).  Subsequently the user can
choose a new name from the list by using the up and down-arrow keys.
The function <var class="zed">aname</var> calculates the new name by ``dead
reckoning'' from the old name, the list, and the arrow key (it is
not necessary for the program to poll the console for the cursor
position).  The list remains visible.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed"> v_arrow == { up_arrow, down_arrow } </td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td width=1 rowspan=99 bgcolor=black><img width=1 height=1 alt="\begin{axdef}" src="zimg/clear.gif"><br></td></tr>
<tr> <td></td><td class="zed" colspan=2>aname: (v_arrow <img width=7 height=7 alt="\cross" src="zimg/cross-m.gif"> NAME <img width=7 height=7 alt="\cross" src="zimg/cross-m.gif"> <img height=11 width=9 alt="\power" src="zimg/power-m.gif"><sub><font size=-3>1</font></sub> NAME) <img width=14 height=8 alt="\fun" src="zimg/fun-m.gif"> NAME </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=9 height=10 alt="\forall" src="zimg/forall-m.gif"> a: v_arrow; n: NAME; list: <img height=11 width=9 alt="\power" src="zimg/power-m.gif"><sub><font size=-3>1</font></sub> NAME <img width=7 height=7 alt="@" src="zimg/spot-m.gif"> aname(a,n,list) <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> list</td></tr>
<tr><td width=10 height=1><img width=10 height=1 alt="\end{axdef}" src="zimg/clear.gif"></td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed">Continue <img height=11 width=11 alt="\defs" src="zimg/defs-m.gif"> [&nbsp; <img width=7 height=10 alt="\Delta" src="zimg/Delta-m.gif"> Console | interaction' = interaction <img width=8 height=7 alt="\land" src="zimg/land-m.gif"> op' = op <img width=8 height=7 alt="\land" src="zimg/land-m.gif"> display' = display &nbsp;]</td></tr>
</table>
</div>

<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">GetListArrow</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>EventUnlocked </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=7 height=10 alt="\Delta" src="zimg/Delta-m.gif"> List</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>input? <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> v_arrow </td></tr>
<tr> <td></td><td class="zed" colspan=2>list_item' = aname(input?,list_item,nlist) </td></tr>
<tr> <td></td><td class="zed" colspan=2>Continue </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
This is a <var class="zed">Continue</var> operation that does not change <var class="zed">interaction</var>,
<var class="zed">op</var>, or <var class="zed">display</var>.  Here <var class="zed">list_item</var> is the only state variable that
changes.  We do not completely specify <var class="zed">default_name</var> and <var class="zed">aname</var>; we
leave that to the implementation.  Here we merely provide the
predicates needed to ensure that the implementation does not abort.
</p>

<p class="informal">
The user presses the <var class="zed">select</var> key to choose the current <var class="zed">list_item</var>
for some purpose.  The selection is logged; <var class="zed">nmessage</var> converts the
name to a log message.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td width=1 rowspan=99 bgcolor=black><img width=1 height=1 alt="\begin{axdef}" src="zimg/clear.gif"><br></td></tr>
<tr> <td></td><td class="zed" colspan=2>selected_msg: NAME <img width=14 height=8 alt="\fun" src="zimg/fun-m.gif"> MESSAGE</td></tr>
<tr><td width=10 height=1><img width=10 height=1 alt="\end{axdef}" src="zimg/clear.gif"></td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">SelectName</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>Select </td></tr>
<tr> <td></td><td class="zed" colspan=2>name!: NAME </td></tr>
<tr> <td></td><td class="zed" colspan=2>message!: MESSAGE </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>List </td></tr>
<tr> <td></td><td class="zed" colspan=2>name! = list_item </td></tr>
<tr> <td></td><td class="zed" colspan=2>message! = selected_msg&nbsp;name!</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
<var class="zed">GetListArrow</var> and <var class="zed">SelectName</var> are not total operations; they do not
handle the case where <var class="zed">nlist = <img width=11 height=11 alt="\emptyset" src="zimg/emptyset-m.gif"></var>.  The latter case is handled
by a default do-nothing operation, <var class="zed">IgnoreOthers</var>, which includes
<var class="zed">Ignore</var>.  We do not define the precondition of this operation
explicitly; we code the implementation so control reaches
<var class="zed">IgnoreOthers</var> when no other operations are enabled.
</p>


<h4><a name="Tables">Tables</a></h4>

<p class="informal">
Certain displays show a table of items (settings for one subsystem,
calibration factors etc.).  The constant <var class="zed">table_items</var> tells which
items on each table can be selected for editing or overriding
(additional items may be displayed as well).  When a tabular display
is selected, the default <var class="zed">item</var> is assigned, and the <var class="zed">Table</var> state
results.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td width=1 rowspan=99 bgcolor=black><img width=1 height=1 alt="\begin{axdef}" src="zimg/clear.gif"><br></td></tr>
<tr> <td></td><td class="zed" colspan=2>table: <img height=11 width=9 alt="\power" src="zimg/power-m.gif"> DISPLAY</td></tr>
<tr><td width=10 height=1><img width=10 height=1 alt="\end{axdef}" src="zimg/clear.gif"></td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td width=1 rowspan=99 bgcolor=black><img width=1 height=1 alt="\begin{axdef}" src="zimg/clear.gif"><br></td></tr>
<tr> <td></td><td class="zed" colspan=2>default_item: table <img width=14 height=8 alt="\fun" src="zimg/fun-m.gif"> ITEM </td></tr>
<tr> <td></td><td class="zed" colspan=2>table_items: table <img width=14 height=8 alt="\fun" src="zimg/fun-m.gif"> <img height=11 width=9 alt="\power" src="zimg/power-m.gif"><sub><font size=-3>1</font></sub> ITEM </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr> 
<tr> <td></td><td class="zed" colspan=2><img width=9 height=10 alt="\forall" src="zimg/forall-m.gif"> d: table <img width=7 height=7 alt="@" src="zimg/spot-m.gif"> default_item&nbsp;d <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> table_items&nbsp;d</td></tr>
<tr><td width=10 height=1><img width=10 height=1 alt="\end{axdef}" src="zimg/clear.gif"></td></tr>
</table>
</div>



<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed">Table <img height=11 width=11 alt="\defs" src="zimg/defs-m.gif"> [&nbsp; Available | display <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> table <img width=8 height=7 alt="\land" src="zimg/land-m.gif"> item <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> table_items&nbsp;display &nbsp;]</td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">SelectTable</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>SelectDisplay</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>input? <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> table </td></tr>
<tr> <td></td><td class="zed" colspan=2>item' = default_item&nbsp;display' </td></tr>
<tr> <td></td><td class="zed" colspan=2>Table'</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
Subsequently the user can indicate a new item on the table by using
all four arrow keys.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed"> arrow == { right_arrow, left_arrow } <img width=10 height=7 alt="\cup" src="zimg/cup-m.gif"> v_arrow </td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td width=1 rowspan=99 bgcolor=black><img width=1 height=1 alt="\begin{axdef}" src="zimg/clear.gif"><br></td></tr>
<tr> <td></td><td class="zed" colspan=2>asetting: (arrow <img width=7 height=7 alt="\cross" src="zimg/cross-m.gif"> ITEM <img width=7 height=7 alt="\cross" src="zimg/cross-m.gif"> table) <img width=14 height=8 alt="\fun" src="zimg/fun-m.gif"> ITEM</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=9 height=10 alt="\forall" src="zimg/forall-m.gif"> a: arrow; s: ITEM; d: table <img width=7 height=7 alt="@" src="zimg/spot-m.gif"> asetting(a,s,d) <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> table_items&nbsp;d</td></tr>
<tr><td width=10 height=1><img width=10 height=1 alt="\end{axdef}" src="zimg/clear.gif"></td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">GetSettingArrow</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>EventUnlocked </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=7 height=10 alt="\Delta" src="zimg/Delta-m.gif"> Table</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>input? <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> arrow </td></tr>
<tr> <td></td><td class="zed" colspan=2>item' = asetting(input?,item,display) </td></tr>
<tr> <td></td><td class="zed" colspan=2>Continue</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
Here <var class="zed">item</var> is the only state variable that changes.
</p>

<p class="informal">
Items can be selected from tabular displays for editing or overriding.
Editing or overriding is only enabled in the <var class="zed">Setup</var> state (when a
treatment run is not in progress, see 8.8.2, 183).  Pressing the
<var class="zed">select</var> key when certain tabular displays are present invokes an
editing operation: <var class="zed">edit_setting</var> if the selected item is a <var class="zed">setting</var>
and <var class="zed">edit_dose_reg</var> if it is a <var class="zed">dose_reg</var> (notice that here <var class="zed">op'</var> is
<em>not</em> the same as <var class="zed">input?</var>).  Therefore it is necessary to
separate <var class="zed">setting</var> and <var class="zed">dose_reg</var> items on different
tables (Because the implementation cannot distinguish
<var class="zed">setting</var> from <var class="zed">dose_reg</var> based on <var class="zed">item</var> alone; <var class="zed">item</var> values are
just C <tt>enum</tt> values (integers).).
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td width=1 rowspan=99 bgcolor=black><img width=1 height=1 alt="\begin{axdef}" src="zimg/clear.gif"><br></td></tr>
<tr> <td></td><td class="zed" colspan=2>setting_table, dose_reg_table: <img height=11 width=9 alt="\power" src="zimg/power-m.gif"> table</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=9 height=10 alt="\forall" src="zimg/forall-m.gif"> d: setting_table <img width=7 height=7 alt="@" src="zimg/spot-m.gif"> table_items&nbsp;d <img width=9 height=10 align=absbottom alt="\subseteq" src="zimg/subseteq-m.gif"> setting </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=9 height=10 alt="\forall" src="zimg/forall-m.gif"> d: dose_reg_table <img width=7 height=7 alt="@" src="zimg/spot-m.gif"> table_items&nbsp;d <img width=9 height=10 align=absbottom alt="\subseteq" src="zimg/subseteq-m.gif"> dose_reg </td></tr>
<tr><td width=10 height=1><img width=10 height=1 alt="\end{axdef}" src="zimg/clear.gif"></td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">SelectItem</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>Select</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>Setup </td></tr>
<tr> <td></td><td class="zed" colspan=2>Table </td></tr>
<tr> <td></td><td class="zed" colspan=2>item' = item </td></tr>
<tr> <td></td><td class="zed" colspan=2>(op' = edit_dose_reg <img width=8 height=7 alt="\land" src="zimg/land-m.gif"> display <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> dose_reg_table <img width=8 height=7 alt="\lor" src="zimg/lor-m.gif"> </td></tr>
<tr> <td></td><td class="zed" colspan=2>op' = edit_setting <img width=8 height=7 alt="\land" src="zimg/land-m.gif"> display <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> setting_table)</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
The postcondition here implies <var class="zed">Editing</var>, the invariant of the editing
state (The implementation uses <var class="zed">op</var> to determine whether
<var class="zed">item</var> is an index into <var class="zed">setting</var> or <var class="zed">dose_reg</var>.).
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">Editing</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>Console</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>interaction <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> { dialog, menu } </td></tr>
<tr> <td></td><td class="zed" colspan=2>(op = edit_dose_reg <img width=8 height=7 alt="\land" src="zimg/land-m.gif"> item <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> dose_reg <img width=8 height=7 alt="\lor" src="zimg/lor-m.gif"> </td></tr>
<tr> <td></td><td class="zed" colspan=2>op = edit_setting <img width=8 height=7 alt="\land" src="zimg/land-m.gif"> item <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> setting)</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
The <var class="zed">Setup</var> precondition of <var class="zed">SelectItem</var> prevents the console entering
the <var class="zed">Editing</var> state when a run is in progress.  Other mechanisms
prevent the machine from beginning a run while in the <var class="zed">Editing</var> state.
</p>

<h4><a name="Confirm">Confirm</a></h4>

<p class="informal">
<var class="zed">Confirm</var> interactions present a query (``Are you sure ... ?'')  and
wait for the user to provide a yes/no answer, indicated by the
<var class="zed">select</var> or <var class="zed">cancel</var> keys (for example see 8.9.11, 210).  Each
<var class="zed">Confirm</var> operation presents a confirmation box (a sort of dialog box)
with a <var class="zed">caption</var> that identifies the operation, and the <var class="zed">query</var>.  The
display under the confirmation box does not change.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed">Confirm <img height=11 width=11 alt="\defs" src="zimg/defs-m.gif"> [&nbsp; Console | interaction = confirm &nbsp;]</td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td width=1 rowspan=99 bgcolor=black><img width=1 height=1 alt="\begin{axdef}" src="zimg/clear.gif"><br></td></tr> 
<tr> <td></td><td class="zed" colspan=2>ocaption: OP <img width=14 height=8 alt="\fun" src="zimg/fun-m.gif"> CAPTION </td></tr>
<tr><td width=10 height=1><img width=10 height=1 alt="\end{axdef}" src="zimg/clear.gif"></td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">ConfirmOp</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>Op </td></tr>
<tr> <td></td><td class="zed" colspan=2>caption!, query!: CAPTION</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>caption! = ocaption&nbsp;op' </td></tr>
<tr> <td></td><td class="zed" colspan=2>display' = display </td></tr>
<tr> <td></td><td class="zed" colspan=2>Confirm' </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed">AcceptConfirm <img height=11 width=11 alt="\defs" src="zimg/defs-m.gif"> Confirm <img width=8 height=7 alt="\land" src="zimg/land-m.gif"> Select <img width=8 height=7 alt="\land" src="zimg/land-m.gif"> Done</td></tr>
</table>
</div>


<h4><a name="Menu">Menu</a></h4>

<p class="informal">
When the console is <var class="zed">Available</var> the user can invoke a menu, then make
a selection from the menu.  Each menu includes a caption and a list of
menu entries. The display does not change.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td width=1 rowspan=99 bgcolor=black><img width=1 height=1 alt="\begin{axdef}" src="zimg/clear.gif"><br></td></tr>
<tr> <td></td><td class="zed" colspan=2>default_selection: SELECTION</td></tr>
<tr><td width=10 height=1><img width=10 height=1 alt="\end{axdef}" src="zimg/clear.gif"></td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed">Menu <img height=11 width=11 alt="\defs" src="zimg/defs-m.gif"> [&nbsp; Editing | interaction = menu &nbsp;] </td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">MenuOp</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>Op </td></tr>
<tr> <td></td><td class="zed" colspan=2>caption!: CAPTION </td></tr>
<tr> <td></td><td class="zed" colspan=2>menu!: iseq CAPTION</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>menu_item' = default_selection </td></tr>
<tr> <td></td><td class="zed" colspan=2>display' = display </td></tr>
<tr> <td></td><td class="zed" colspan=2>Menu'</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
Here <var class="zed">op</var> also changes; the other state variables retain the same
values.  
</p>

<p class="informal">
Menus are used to choose new values for <var class="zed">selection</var> items; valid
<var class="zed">selection</var> values are small integers.  Combining <var class="zed">MenuOp</var> with
<var class="zed">SelectItem</var> yields the <var class="zed">MenuEdit</var> operation. The menu shows the item
name and a sequence of descriptive strings indexed by the
corresponding item values. Here again, the <var class="zed">Editing</var> postcondition of
<var class="zed">SelectItem</var> guarantees that <var class="zed">op</var> can be used to help look up
<var class="zed">selection_values&nbsp;item</var>.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td width=1 rowspan=99 bgcolor=black><img width=1 height=1 alt="\begin{axdef}" src="zimg/clear.gif"><br></td></tr>
<tr> <td></td><td class="zed" colspan=2>setting_info_name: ITEM <img width=14 height=8 alt="\fun" src="zimg/fun-m.gif"> CAPTION </td></tr>
<tr> <td></td><td class="zed" colspan=2>setting_value: selection <img width=14 height=8 alt="\fun" src="zimg/fun-m.gif"> iseq CAPTION </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=9 height=10 alt="\forall" src="zimg/forall-m.gif"> s: selection <img width=7 height=7 alt="@" src="zimg/spot-m.gif"> <b>dom</b>&nbsp;(setting_value&nbsp;s) = valid&nbsp;s</td></tr>
<tr><td width=10 height=1><img width=10 height=1 alt="\end{axdef}" src="zimg/clear.gif"></td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">MenuEdit</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>MenuOp </td></tr>
<tr> <td></td><td class="zed" colspan=2>SelectItem </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>item <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> selection </td></tr>
<tr> <td></td><td class="zed" colspan=2>caption! = setting_info_name&nbsp;item;</td></tr>
<tr> <td></td><td class="zed" colspan=2>menu! = setting_value&nbsp;item</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
There are functions to return the default menu selection and the new
selection after each up or down-arrow keypress.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td width=1 rowspan=99 bgcolor=black><img width=1 height=1 alt="\begin{axdef}" src="zimg/clear.gif"><br></td></tr>
<tr> <td></td><td class="zed" colspan=2>amenu: (v_arrow <img width=7 height=7 alt="\cross" src="zimg/cross-m.gif"> SELECTION <img width=7 height=7 alt="\cross" src="zimg/cross-m.gif"> selection) <img width=14 height=8 alt="\fun" src="zimg/fun-m.gif"> SELECTION</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=9 height=10 alt="\forall" src="zimg/forall-m.gif"> s: selection <img width=7 height=7 alt="@" src="zimg/spot-m.gif"> (<b>let</b> n == # (valid&nbsp;s) <img width=7 height=7 alt="@" src="zimg/spot-m.gif"> </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=10 height=1 align=bottom alt="    " src="zimg/clear.gif"><img width=9 height=10 alt="\forall" src="zimg/forall-m.gif"> a: v_arrow; i: SELECTION <img width=7 height=7 alt="@" src="zimg/spot-m.gif"> default_selection <img width=7 height=9 alt="\leq" src="zimg/leq-m.gif"> n <img width=8 height=7 alt="\land" src="zimg/land-m.gif"> amenu(a,i,s) <img width=7 height=9 alt="\leq" src="zimg/leq-m.gif"> n)</td></tr>
<tr><td width=10 height=1><img width=10 height=1 alt="\end{axdef}" src="zimg/clear.gif"></td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">GetMenuArrow</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>EventUnlocked </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=7 height=10 alt="\Delta" src="zimg/Delta-m.gif"> Menu</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>input? <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> v_arrow </td></tr>
<tr> <td></td><td class="zed" colspan=2>menu_item' = amenu(input?,menu_item,item) </td></tr>
<tr> <td></td><td class="zed" colspan=2>Continue </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
Here <var class="zed">item</var> is the only variable that changes.
</p>

<p class="informal">
The user presses <var class="zed">select</var> to accept the current menu item and the
console becomes available again.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed"> AcceptMenu <img height=11 width=11 alt="\defs" src="zimg/defs-m.gif"> Menu <img width=8 height=7 alt="\land" src="zimg/land-m.gif"> Select <img width=8 height=7 alt="\land" src="zimg/land-m.gif"> Done </td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">MenuSettingC</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>AcceptMenu </td></tr>
<tr> <td></td><td class="zed" colspan=2>item!: ITEM </td></tr>
<tr> <td></td><td class="zed" colspan=2>value!: VALUE</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>Editing </td></tr>
<tr> <td></td><td class="zed" colspan=2>item! = item </td></tr>
<tr> <td></td><td class="zed" colspan=2>value! = menu_item</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>


<h4><a name="Dialog">Dialog</a></h4>

<p class="informal">
When the console is <var class="zed">Available</var> the user can begin a dialog, then type
and edit text in a dialog box.  The dialog box contains a <var class="zed">caption</var>
and a <var class="zed">prompt</var> that may include the values of other state variables.
The display under the dialog box does not change.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed"> Dialog <img height=11 width=11 alt="\defs" src="zimg/defs-m.gif"> [&nbsp; Console | interaction = dialog &nbsp;] </td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">DialogOp</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>Op </td></tr>
<tr> <td></td><td class="zed" colspan=2>caption!, prompt!: CAPTION </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>caption! = ocaption&nbsp;op' </td></tr>
<tr> <td></td><td class="zed" colspan=2>display' = display </td></tr>
<tr> <td></td><td class="zed" colspan=2>Dialog'</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
Here only <var class="zed">interaction</var>, <var class="zed">buffer</var>, and <var class="zed">op</var> change.  The <var class="zed">buffer</var> may
be emptied, or may be filled with a convenient default value.  We'll describe
changes to <var class="zed">op</var> later, with each dialog operation.
</p>

<p class="informal">
The console remains in <var class="zed">Dialog</var> while the user types and edits.
The <var class="zed">GetChar</var> operation gets a single character and
updates the buffer as described by the <var class="zed">modify</var> function (append
printing characters to the end of <var class="zed">buffer</var>, and do the appropriate
things with editing characters).
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td width=1 rowspan=99 bgcolor=black><img width=1 height=1 alt="\begin{axdef}" src="zimg/clear.gif"><br></td></tr>
<tr> <td></td><td class="zed" colspan=2>CHAR: <img height=11 width=9 alt="\power" src="zimg/power-m.gif"> INPUT</td></tr>
<tr><td width=10 height=1><img width=10 height=1 alt="\end{axdef}" src="zimg/clear.gif"></td></tr>
</table>
</div>

<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td width=1 rowspan=99 bgcolor=black><img width=1 height=1 alt="\begin{axdef}" src="zimg/clear.gif"><br></td></tr>
<tr> <td></td><td class="zed" colspan=2>modify: (STRING <img width=7 height=7 alt="\cross" src="zimg/cross-m.gif"> CHAR) <img width=14 height=8 alt="\fun" src="zimg/fun-m.gif"> STRING</td></tr>
<tr><td width=10 height=1><img width=10 height=1 alt="\end{axdef}" src="zimg/clear.gif"></td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">GetChar</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>EventUnlocked </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=7 height=10 alt="\Delta" src="zimg/Delta-m.gif"> Dialog</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>input? <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> CHAR </td></tr>
<tr> <td></td><td class="zed" colspan=2>buffer' = modify(buffer,input?) </td></tr>
<tr> <td></td><td class="zed" colspan=2>Continue </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
Here <var class="zed">buffer</var> is the only variable that changes.
</p>

<p class="informal">
When a dialog is done, the dialog box disappears and the console
becomes available again. At any time the user can <var class="zed">cancel</var> the dialog
and discard the input.  To submit the input, the user presses a
<var class="zed">terminator</var> key; the program can <var class="zed">Accept</var> the input or <var class="zed">Reprompt</var>
(the user may also <var class="zed">Cancel</var> the dialog).
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td width=1 rowspan=99 bgcolor=black><img width=1 height=1 alt="\begin{axdef}" src="zimg/clear.gif"><br></td></tr>
<tr> <td></td><td class="zed" colspan=2>terminator: <img height=11 width=9 alt="\power" src="zimg/power-m.gif"> INPUT</td></tr>
<tr><td width=10 height=1><img width=10 height=1 alt="\end{axdef}" src="zimg/clear.gif"></td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">Accept</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>Done</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>Dialog </td></tr>
<tr> <td></td><td class="zed" colspan=2>input? <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> terminator</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">Reprompt</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>EventUnlocked </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=7 height=10 alt="\Delta" src="zimg/Delta-m.gif"> Dialog</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>input? <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> terminator </td></tr>
<tr> <td></td><td class="zed" colspan=2>buffer' = empty </td></tr>
<tr> <td></td><td class="zed" colspan=2>Continue</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
Here again, <var class="zed">buffer</var> is the only variable that changes.
</p>

<p class="informal">
Dialogs are frequently used to edit item values. Combining <var class="zed">DialogOp</var>
with <var class="zed">SelectItem</var> yields the <var class="zed">DialogEdit</var> operation.  Dialog box
editing begins if the selected item is not a <var class="zed">selection</var> (does not
have just a few discrete values).  The program captions the dialog box
with the item name and the minimum and maximum valid item
values (The dialog box caption also includes the units, but we
do not model this formally.).
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed"> MIN == VALUE; MAX == VALUE </td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td width=1 rowspan=99 bgcolor=black><img width=1 height=1 alt="\begin{axdef}" src="zimg/clear.gif"><br></td></tr>
<tr> <td></td><td class="zed" colspan=2>setting_info: ITEM <img width=7 height=7 alt="\cross" src="zimg/cross-m.gif"> MIN <img width=7 height=7 alt="\cross" src="zimg/cross-m.gif"> MAX <img width=14 height=8 alt="\fun" src="zimg/fun-m.gif"> CAPTION</td></tr>
<tr><td width=10 height=1><img width=10 height=1 alt="\end{axdef}" src="zimg/clear.gif"></td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">DialogEdit</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>DialogOp </td></tr>
<tr> <td></td><td class="zed" colspan=2>SelectItem </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>item <img width=7 height=11 align=absbottom alt="\notin" src="zimg/notin-m.gif"> selection </td></tr>
<tr> <td></td><td class="zed" colspan=2>prompt! = (<b>let</b> v == valid&nbsp;item <img width=7 height=7 alt="@" src="zimg/spot-m.gif"> setting_info(item, min&nbsp;v, max&nbsp;v))</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
The implementation uses the value of <var class="zed">op</var> guaranteed by the <var class="zed">Editing</var>
postcondition of <var class="zed">SelectItem</var> to look up <var class="zed">valid&nbsp;item</var>; there are
separate <var class="zed">valid</var> arrays for <var class="zed">dose_reg</var> and <var class="zed">setting</var>.
</p>

<p class="informal">
When the user presses a terminator key, the program attempts to
convert the buffer contents to a (numeric) value (non-numeric strings
are always converted to an out-of-range value).  If the conversion
succeeds and the value is valid for the item, the dialog ends and the
item and its value are reported; otherwise, the program reprompts.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td width=1 rowspan=99 bgcolor=black><img width=1 height=1 alt="\begin{axdef}" src="zimg/clear.gif"><br></td></tr>
<tr> <td></td><td class="zed" colspan=2>sval: STRING <img width=14 height=8 alt="\fun" src="zimg/fun-m.gif"> VALUE</td></tr>
<tr><td width=10 height=1><img width=10 height=1 alt="\end{axdef}" src="zimg/clear.gif"></td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">EditSettingC</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>Accept </td></tr>
<tr> <td></td><td class="zed" colspan=2>item!: ITEM </td></tr>
<tr> <td></td><td class="zed" colspan=2>value!: VALUE</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>Editing </td></tr>
<tr> <td></td><td class="zed" colspan=2>item! = item </td></tr>
<tr> <td></td><td class="zed" colspan=2>(<b>let</b> v == sval&nbsp;buffer <img width=7 height=7 alt="@" src="zimg/spot-m.gif"> v <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> valid&nbsp;item <img width=8 height=7 alt="\land" src="zimg/land-m.gif"> value! = v)</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed">InvalidSetting <img height=11 width=11 alt="\defs" src="zimg/defs-m.gif"> [&nbsp; Reprompt | Editing <img width=8 height=7 alt="\land" src="zimg/land-m.gif"> sval&nbsp;buffer <img width=7 height=11 align=absbottom alt="\notin" src="zimg/notin-m.gif"> valid&nbsp;item &nbsp;]</td></tr>
</table>
</div>

<p class="informal">
In the implementation it is convenient to combine these two
operations (In <var class="zed">EditOrInvalidSetting</var>, the two outputs <var class="zed">item!</var>
and <var class="zed">value!</var> are not used in the <var class="zed">Invalid</var> case.).
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed">EditOrInvalidSetting <img height=11 width=11 alt="\defs" src="zimg/defs-m.gif"> EditSettingC <img width=8 height=7 alt="\lor" src="zimg/lor-m.gif"> InvalidSetting</td></tr>
</table>
</div>


<h3><a name="Therapy console operations">Therapy console operations</a></h3> 

<p class="informal">
In this subsection we present the operations described
in <a href="ftp://ftp.radonc.washington.edu:/pub/cnts-reports/spec2">[jacky92]</a>.  Several building block operations require no
further elaboration: <var class="zed">SelectDisplay</var>, <var class="zed">SelectTable</var>, <var class="zed">GetListArrow</var>,
<var class="zed">GetSettingArrow</var>, <var class="zed">Cancel</var>, <var class="zed">GetMenuArrow</var>, <var class="zed">MenuSettingC</var>,
<var class="zed">GetChar</var>, and <var class="zed">EditOrInvalidSetting</var> and are already complete.
Others require further specialization in the following subsections.
</p>

<h4><a name="Relation to Session state">Relation to Session state</a></h4>

<p class="informal">
A few <var class="zed">Console</var> operations read (but do not change) variables from the
<var class="zed">Session</var> state (section <a href="#Session">[sect:session]</a>).  When the <var class="zed">Console</var>
shows the patient or field list, its <var class="zed">nlist</var> state variable holds the
patients or fields from the <var class="zed">Session</var> state.  This is expressed by the
<var class="zed">ConsoleSession</var> invariant:
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">ConsoleSession</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>Console </td></tr>
<tr> <td></td><td class="zed" colspan=2>Session</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>display = select_patient <img width=13 height=7 alt="\implies" src="zimg/implies-m.gif"> nlist = names </td></tr>
<tr> <td></td><td class="zed" colspan=2>display = select_field <img width=13 height=7 alt="\implies" src="zimg/implies-m.gif"> nlist = <b>dom</b> fields</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>


<h4><a name="Op operations">Op operations</a></h4>

<p class="informal">
Several operations are based only on <var class="zed">Op</var>.  They are <var class="zed">Continue</var>
operations because they do not involve any ongoing interaction, just a
single keypress.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed"> SimpleOp <img height=11 width=11 alt="\defs" src="zimg/defs-m.gif"> Op <img width=8 height=7 alt="\land" src="zimg/land-m.gif"> Continue </td></tr>
</table>
</div>


<p class="informal">
<b>Experiment Mode</b> (8.9.6, 190):
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">ExptModeC</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>SimpleOp </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=9 height=10 alt="\Xi" src="zimg/Xi-m.gif"> Session </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=7 height=10 alt="\Delta" src="zimg/Delta-m.gif"> ConsoleSession </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>Setup </td></tr>
<tr> <td></td><td class="zed" colspan=2>input? = expt_mode </td></tr>
<tr> <td></td><td class="zed" colspan=2>operator <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> physicists </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
<b>Auto Setup</b> (8.8.1, 181):
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed">auto_setup_display == { field_summary, filter_wedge, leaf_collim, dose_intlk }</td></tr>
</table>
</div>

<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">AutoSetupC</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>SimpleOp </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=9 height=10 alt="\Xi" src="zimg/Xi-m.gif"> ConsoleSession </td></tr>
<tr> <td></td><td class="zed" colspan=2>subsystem!: auto_setup_display </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>Setup </td></tr>
<tr> <td></td><td class="zed" colspan=2>field <img width=7 height=7 alt="\neq" src="zimg/neq-m.gif"> no_field </td></tr>
<tr> <td></td><td class="zed" colspan=2>display <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> auto_setup_display </td></tr>
<tr> <td></td><td class="zed" colspan=2>input? = auto_setup </td></tr>
<tr> <td></td><td class="zed" colspan=2>subsystem! = display </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>


<h4><a name="SelectDisplay operations">SelectDisplay operations</a></h4>

<p class="informal">
There are a few simple displays that provide no selections or
interactive editing, <b>Field Summary</b> (8.9.7, 191) and
the <var class="zed">help</var> display (not discussed in
<a href="ftp://ftp.radonc.washington.edu:/pub/cnts-reports/spec2">[jacky92]</a>
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed"> simple_display == {  field_summary, help } </td></tr>
</table>
</div>


<h4><a name="SelectList operations">SelectList operations</a></h4>

<p class="informal">
The specializations of <var class="zed">SelectList</var> are <b>Select Patient</b>
(8.9.3, 184) and <b>Select Field</b> (8.9.4, 186).  The latter
operation only makes sense when a patient has been selected:
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed"> list = { select_patient, select_field } </td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">SelectPatientList</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>SelectList </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=9 height=10 alt="\Xi" src="zimg/Xi-m.gif"> Session </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=7 height=10 alt="\Delta" src="zimg/Delta-m.gif"> ConsoleSession </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>input? = select_patient </td></tr>
<tr> <td></td><td class="zed" colspan=2>nlist' = names </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">SelectFieldList</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>SelectList </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=9 height=10 alt="\Xi" src="zimg/Xi-m.gif"> Session </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=7 height=10 alt="\Delta" src="zimg/Delta-m.gif"> ConsoleSession </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>patient <img width=7 height=7 alt="\neq" src="zimg/neq-m.gif"> no_patient </td></tr>
<tr> <td></td><td class="zed" colspan=2>input? = select_field </td></tr>
<tr> <td></td><td class="zed" colspan=2>nlist' = <b>dom</b> fields</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>


<h4><a name="SelectTable operations">SelectTable operations</a></h4>

<p class="informal">
The <var class="zed">table</var> displays are <b>Gantry/PSA</b> (8.9.8, 193), 
<b>Filter/Wedge</b> (8.9.9, 194), <b>Leaf Collimator</b> (8.9.10, 196), 
<b>Dosimetry/Therapy Interlocks</b> (8.9.11, 199) and 
<b>Calibration Factors</b> (8.9.13, 213):
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed">table = { gantry_psa,filter_wedge,leaf_collim,dose_intlk,dose_cal }</td></tr>
</table>
</div>

<p class="informal">
The constant <var class="zed">table_items</var> tells which items on each table can be
selected for editing or overriding (additional items may be displayed as
well).
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed">table_items&nbsp; = { gantry_psa <img height=9 width=10 alt="\mapsto" src="zimg/mapsto-m.gif"> { gantry, collim, turnt }, filter_wedge <img height=9 width=10 alt="\mapsto" src="zimg/mapsto-m.gif"> { filter, wedge, w_rot }, </td></tr>
<tr> <td class="zed"><img width=50 height=1 align=bottom alt="    " src="zimg/clear.gif">leaf_collim <img height=9 width=10 alt="\mapsto" src="zimg/mapsto-m.gif"> leaves, dose_intlk <img height=9 width=10 alt="\mapsto" src="zimg/mapsto-m.gif"> { p_dose, p_time }, </td></tr>
<tr> <td class="zed"><img width=50 height=1 align=bottom alt="    " src="zimg/clear.gif">dose_cal <img height=9 width=10 alt="\mapsto" src="zimg/mapsto-m.gif">{ pt_mode,press,temp,d_rate,t_fac } }</td></tr>
</table>
</div>

<p class="informal">
It is necessary to separate <var class="zed">setting</var> and <var class="zed">dose_reg</var> items on
different tables:
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed">setting_table = { gantry_psa,filter_wedge,leaf_collim }</td></tr>
<tr> <td class="zed"><img width=1 height=10 align=bottom alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td class="zed">dose_reg_table = { dose_intlk, dose_cal }</td></tr>
</table>
</div>

<p class="informal">
Now that these constants are defined, the previously defined
<var class="zed">SelectTable</var> operation requires no further specialization.
</p>

<h4><a name="ConfirmOp operations">ConfirmOp operations</a></h4>

<p class="informal">
To begin <b>Cancel Run</b> (8.9.11, 209 -- 210):
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td width=1 rowspan=99 bgcolor=black><img width=1 height=1 alt="\begin{axdef}" src="zimg/clear.gif"><br></td></tr>
<tr> <td></td><td class="zed" colspan=2>cancel_run_query: CAPTION</td></tr>
<tr><td width=10 height=1><img width=10 height=1 alt="\end{axdef}" src="zimg/clear.gif"></td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">SelectCancelRun</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>ConfirmOp </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>Running </td></tr>
<tr> <td></td><td class="zed" colspan=2>input? = cancel_run </td></tr>
<tr> <td></td><td class="zed" colspan=2>op' = input? </td></tr>
<tr> <td></td><td class="zed" colspan=2>query! = cancel_run_query</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
The complementary <var class="zed">AcceptConfirm</var> operation is <var class="zed">CancelRunC</var> (below).
</p>

<h4><a name="MenuOp operations">MenuOp operations</a></h4>

<p class="informal">
At this writing there are no simple <var class="zed">MenuOp</var> operations, only
<var class="zed">MenuEdit</var> operations (under <var class="zed">Setup</var>, below).
</p>

<h4><a name="DialogOp operations">DialogOp operations</a></h4>


<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td width=1 rowspan=99 bgcolor=black><img width=1 height=1 alt="\begin{axdef}" src="zimg/clear.gif"><br></td></tr>
<tr> <td></td><td class="zed" colspan=2>type_message_prompt, store_field_prompt: CAPTION</td></tr>
<tr><td width=10 height=1><img width=10 height=1 alt="\end{axdef}" src="zimg/clear.gif"></td></tr>
</table>
</div>


<p class="informal">
To begin <b>Write Log Message</b> (2.5.1, 17):
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">TypeMessage</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>DialogOp</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>input? = log_message </td></tr>
<tr> <td></td><td class="zed" colspan=2>op' = input?  </td></tr>
<tr> <td></td><td class="zed" colspan=2>prompt! = type_message_prompt</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
To begin <b>Store Field</b> (8.9.5, 189 -- 188):
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">EditField</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>DialogOp</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>Setup </td></tr>
<tr> <td></td><td class="zed" colspan=2>input? = store_field </td></tr>
<tr> <td></td><td class="zed" colspan=2>op' = input? </td></tr>
<tr> <td></td><td class="zed" colspan=2>prompt! = store_field_prompt</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
These two operations are completed by the complementary <var class="zed">Accept</var>
operations, <var class="zed">WriteMessageC</var> and <var class="zed">StoreFieldC</var> (below).
</p>

<h4><a name="Setup operations">Setup operations</a></h4>

<p class="informal">
Under <var class="zed">Setup</var>, there are <var class="zed">SelectName</var>, <var class="zed">SelectItem</var>, <var class="zed">MenuEdit</var> and
<var class="zed">DialogEdit</var> operations.
</p>

<p class="informal">
<b>Select Patient</b> (8.9.3, 184 -- 185):
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">SelectPatientC</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>SelectName</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>Setup </td></tr>
<tr> <td></td><td class="zed" colspan=2>display = select_patient </td></tr>
<tr> <td></td><td class="zed" colspan=2>Continue</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
At this writing, <var class="zed">SelectPatient</var> is a <var class="zed">Continue</var> operation; the
patient list remains on the screen (We also considered
establishing <var class="zed">display' = select_field</var> in <var class="zed">SelectPatientC</var>.  It would
not be difficult to adopt this alternative later.).
</p>

<p class="informal">
<b>SelectField</b> (8.9.4, 186 -- 189): There are three cases.  The
simplest case occurs during experiment mode, or when the chosen field
has not yet been delivered today and the prescribed total dose and
number of fractions has not yet been exceeded (8.9.4, 187).
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">NewFieldC</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>SelectName </td></tr>
<tr> <td></td><td class="zed" colspan=2>ConsoleSession</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>Setup </td></tr>
<tr> <td></td><td class="zed" colspan=2>display = select_field </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">SelectSimpleFieldC</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>NewFieldC</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>mode = experiment </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=8 height=7 alt="\lor" src="zimg/lor-m.gif"> (counters&nbsp;name!&nbsp;dose = 0 <img width=8 height=7 alt="\land" src="zimg/land-m.gif"> <img width=7 height=7 alt="\lnot" src="zimg/lnot-m.gif"> exceeded(fields&nbsp;name!, counters&nbsp;name!)) </td></tr>
<tr> <td></td><td class="zed" colspan=2>Continue</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
The more complicated cases arise in therapy mode when the operator
must be warned of some unusual condition (8.9.4, 187-188).  These are
<var class="zed">DialogOp</var> operations. The name of the new field must be stored during
the dialog.  The operator may enter a preset dose or cancel
the dialog (so no new field is selected).
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">Console1</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>ConsoleSession </td></tr>
<tr> <td></td><td class="zed" colspan=2>new_field: FIELD </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>new_field <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> <b>dom</b> fields</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">DoseDialogOp</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>NewFieldC </td></tr>
<tr> <td></td><td class="zed" colspan=2>DialogOp </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=7 height=10 alt="\Delta" src="zimg/Delta-m.gif"> Console1 </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>op' = select_field </td></tr>
<tr> <td></td><td class="zed" colspan=2>new_field' = name! </td></tr>
<tr> <td></td><td class="zed" colspan=2>mode = therapy </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
There are two such cases. The first arises when the same field has
already been delivered on the same day but the prescribed daily dose
has not yet been reached; the remaining dose is offered as the default
(8.9.4, 187):
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td width=1 rowspan=99 bgcolor=black><img width=1 height=1 alt="\begin{axdef}" src="zimg/clear.gif"><br></td></tr>
<tr> <td></td><td class="zed" colspan=2>sprintf: VALUE <img width=14 height=8 alt="\fun" src="zimg/fun-m.gif"> STRING </td></tr>
<tr> <td></td><td class="zed" colspan=2>delivered_prompt: NAME <img width=7 height=7 alt="\cross" src="zimg/cross-m.gif"> VALUE <img width=7 height=7 alt="\cross" src="zimg/cross-m.gif"> VALUE <img width=7 height=7 alt="\cross" src="zimg/cross-m.gif"> VALUE <img width=14 height=8 alt="\fun" src="zimg/fun-m.gif"> CAPTION </td></tr>
<tr><td width=10 height=1><img width=10 height=1 alt="\end{axdef}" src="zimg/clear.gif"></td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">SelectDeliveredField</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>DoseDialogOp</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>counters&nbsp;new_field'&nbsp;dose &gt; 0 </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=7 height=7 alt="\lnot" src="zimg/lnot-m.gif"> exceeded(fields&nbsp;new_field', counters&nbsp;new_field') </td></tr>
<tr> <td></td><td class="zed" colspan=2>(<b>let</b> d == fields&nbsp;new_field'&nbsp;dose; c == counters&nbsp;new_field'&nbsp;dose <img width=7 height=7 alt="@" src="zimg/spot-m.gif"> </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=10 height=1 align=bottom alt="    " src="zimg/clear.gif"> (<b>let</b> default_dose == d-c <img width=7 height=7 alt="@" src="zimg/spot-m.gif"> </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=20 height=1 align=bottom alt="    " src="zimg/clear.gif">  buffer' = sprintf&nbsp;default_dose <img width=8 height=7 alt="\land" src="zimg/land-m.gif"> </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=20 height=1 align=bottom alt="    " src="zimg/clear.gif">   prompt! = delivered_prompt(new_field', d, c, default_dose)))</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
The other case arises when the daily dose, the total dose or the
number of fractions has been exceeded (8.9.4, 188).  No default dose
is provided.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td width=1 rowspan=99 bgcolor=black><img width=1 height=1 alt="\begin{axdef}" src="zimg/clear.gif"><br></td></tr>
<tr> <td></td><td class="zed" colspan=2>exceeded_prompt: NAME <img width=7 height=7 alt="\cross" src="zimg/cross-m.gif"> ACCUMULATION <img width=7 height=7 alt="\cross" src="zimg/cross-m.gif"> ACCUMULATION <img width=14 height=8 alt="\fun" src="zimg/fun-m.gif"> CAPTION</td></tr>
<tr><td width=10 height=1><img width=10 height=1 alt="\end{axdef}" src="zimg/clear.gif"></td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">SelectExceededField</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>DoseDialogOp</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>exceeded(fields&nbsp;new_field', counters&nbsp;new_field') </td></tr>
<tr> <td></td><td class="zed" colspan=2>prompt! = exceeded_prompt(new_field', fields&nbsp;new_field', counters&nbsp;new_field') </td></tr>
<tr> <td></td><td class="zed" colspan=2>buffer' = empty </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
The complete operation is composed of all these cases.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0> 
<tr> <td class="zed">SelectFieldC <img height=11 width=11 alt="\defs" src="zimg/defs-m.gif"> </td></tr>
<tr> <td class="zed"> SelectSimpleFieldC <img width=8 height=7 alt="\lor" src="zimg/lor-m.gif"> SelectDeliveredField <img width=8 height=7 alt="\lor" src="zimg/lor-m.gif"> SelectExceededField</td></tr>
</table>
</div>

<p class="informal">
After <var class="zed">SelectSimpleFieldC</var>, nothing more need be done.
<var class="zed">SelectExceededField</var> and <var class="zed">SelectDeliveredField</var> are succeeded by the 
<var class="zed">SelectFieldOp</var> state, which is handled by the <var class="zed">SelectComplexFieldS</var>
operation.  
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">SelectFieldOp</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>Console1 </td></tr>
<tr> <td></td><td class="zed" colspan=2>Dialog </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>op = select_field</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>


<p class="informal">
<b>Override</b> (8.4, 175; 8.8.1, 181; 8.8.2, 183) is also a <var class="zed">ConfirmOp</var>
operation, enabled only when a field has been selected.  The name of
the item that the operator selected is echoed in the confirmation
dialog.  To begin <b>Override</b>:
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed">override_table == { filter_wedge, leaf_collim, gantry_psa, dose_intlk }</td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td width=1 rowspan=99 bgcolor=black><img width=1 height=1 alt="\begin{axdef}" src="zimg/clear.gif"><br></td></tr>
<tr> <td></td><td class="zed" colspan=2>override_query: CAPTION <img width=14 height=8 alt="\fun" src="zimg/fun-m.gif"> CAPTION</td></tr>
<tr><td width=10 height=1><img width=10 height=1 alt="\end{axdef}" src="zimg/clear.gif"></td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">SelectOverride</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>ConfirmOp </td></tr>
<tr> <td></td><td class="zed" colspan=2>SelectItem </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=9 height=10 alt="\Xi" src="zimg/Xi-m.gif"> Session </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>field <img width=7 height=7 alt="\neq" src="zimg/neq-m.gif"> no_field </td></tr>
<tr> <td></td><td class="zed" colspan=2>display <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> override_table </td></tr>
<tr> <td></td><td class="zed" colspan=2>input? = override_cmd </td></tr>
<tr> <td></td><td class="zed" colspan=2>op' = input? </td></tr>
<tr> <td></td><td class="zed" colspan=2>query! = override_query(setting_info_name&nbsp;item)</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
The complementary <var class="zed">AcceptConfirm</var> operations is <var class="zed">OverrideC</var> (below).
</p>

<p class="informal">
<b>Edit</b>: There are three cases.  Calibration factors can be edited
in experiment mode (8.9.13, 215), preset dose and time can be edited
in both modes when a field is selected (8.9.11, 201--202), and other
preset items can be edited in experiment mode when a field is selected
(8.8.1, 180--181; 8.9.8, 194; 8.9.9, 196; 8.9.10, 198).
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed">cal_table == { dose_cal }</td></tr>
<tr> <td class="zed"><img width=1 height=10 align=bottom alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td class="zed">dose_table == { dose_intlk }</td></tr>
<tr> <td class="zed"><img width=1 height=10 align=bottom alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td class="zed">preset_table == { filter_wedge, leaf_collim }</td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed">CalTable <img height=11 width=11 alt="\defs" src="zimg/defs-m.gif"> [&nbsp; ConsoleSession | mode = experiment <img width=8 height=7 alt="\land" src="zimg/land-m.gif"> display <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> cal_table &nbsp;]</td></tr>
</table>
</div>

<p class="informal">
The precondition <var class="zed">field <img width=7 height=7 alt="\neq" src="zimg/neq-m.gif"> no_field</var> occurs elsewhere so it is
convenient to collect two cases together.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">SettingTable</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>ConsoleSession</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>display <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> dose_table <img width=8 height=7 alt="\lor" src="zimg/lor-m.gif"> (mode = experiment <img width=8 height=7 alt="\land" src="zimg/land-m.gif"> display <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> preset_table)</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
Finally 
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed">SelectCalMenu <img height=11 width=11 alt="\defs" src="zimg/defs-m.gif"> CalTable <img width=8 height=7 alt="\land" src="zimg/land-m.gif"> MenuEdit</td></tr>
<tr> <td class="zed"><img width=1 height=10 align=bottom alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td class="zed">SelectCalDialog <img height=11 width=11 alt="\defs" src="zimg/defs-m.gif"> CalTable <img width=8 height=7 alt="\land" src="zimg/land-m.gif"> DialogEdit</td></tr>
<tr> <td class="zed"><img width=1 height=10 align=bottom alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td class="zed">SelectSettingMenu <img height=11 width=11 alt="\defs" src="zimg/defs-m.gif"> SettingTable <img width=8 height=7 alt="\land" src="zimg/land-m.gif"> MenuEdit</td></tr>
<tr> <td class="zed"><img width=1 height=10 align=bottom alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td class="zed">SelectSettingDialog <img height=11 width=11 alt="\defs" src="zimg/defs-m.gif"> SettingTable <img width=8 height=7 alt="\land" src="zimg/land-m.gif"> DialogEdit</td></tr>
</table>
</div>

<p class="informal">
The complementary operations are <var class="zed">EditSettingC</var> and <var class="zed">MenuSettingC</var>
(section <a href="#Elements of user interaction">[sect:gui-elts]</a>, above).
</p>

<h4><a name="Cancel operations">Cancel operations</a></h4>

<p class="informal">
There is a special <var class="zed">cancel</var> operation for the login process (below) so
we have to strengthen the preconditions on <var class="zed">Cancel</var>:
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0> 
<tr> <td class="zed">LoggedIn <img height=11 width=11 alt="\defs" src="zimg/defs-m.gif"> [ Console | op <img width=7 height=11 align=absbottom alt="\notin" src="zimg/notin-m.gif"> { login, password } ]</td></tr>
<tr> <td class="zed"><img width=1 height=10 align=bottom alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td class="zed">CancelOp <img height=11 width=11 alt="\defs" src="zimg/defs-m.gif"> LoggedIn <img width=8 height=7 alt="\land" src="zimg/land-m.gif"> Cancel</td></tr>
</table>
</div>


<h4><a name="AcceptConfirm operations">AcceptConfirm operations</a></h4>

<p class="informal">
To complete <b>Override</b> (8.4, 175; 8.8.1, 181; 8.8.2, 183):
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">OverrideC</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>AcceptConfirm </td></tr>
<tr> <td></td><td class="zed" colspan=2>item!: ITEM</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>op = override_cmd </td></tr>
<tr> <td></td><td class="zed" colspan=2>item! = item</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
To complete <b>Cancel Run</b> (8.9.11, 209 -- 210):
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0> 
<tr> <td class="zed">CancelRunC <img height=11 width=11 alt="\defs" src="zimg/defs-m.gif"> [&nbsp; AcceptConfirm | op = cancel_run &nbsp;]</td></tr>
</table>
</div>


<h4><a name="Accept operations">Accept operations</a></h4>

<p class="informal">
To complete <b>Write Log Message</b> (2.5.1, 17).  The <var class="zed">smessage</var>
function turns a string into a log message by prepending the timestamp
and other information.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td width=1 rowspan=99 bgcolor=black><img width=1 height=1 alt="\begin{axdef}" src="zimg/clear.gif"><br></td></tr>
<tr> <td width=10></td><td class="zed"> log_msg: STRING <img width=14 height=8 alt="\fun" src="zimg/fun-m.gif"> MESSAGE </td></tr>
<tr><td><img width=1 height=1 alt="\end{axdef}" src="zimg/clear.gif"></td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">WriteMessageC</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>Accept </td></tr>
<tr> <td></td><td class="zed" colspan=2>message!: MESSAGE</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>op = log_message </td></tr>
<tr> <td></td><td class="zed" colspan=2>message! = log_msg&nbsp;buffer</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>


<p class="informal">
To complete <b>Store Field</b> (8.9.5, 189 -- 188) (The
<var class="zed">message!</var> output from <var class="zed">StoreFieldC</var> is not mentioned
in <a href="ftp://ftp.radonc.washington.edu:/pub/cnts-reports/spec2">[jacky92]</a>; here we correct the omission.).
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td width=1 rowspan=99 bgcolor=black><img width=1 height=1 alt="\begin{axdef}" src="zimg/clear.gif"><br></td></tr>
<tr> <td></td><td class="zed" colspan=2>sname: STRING <img width=14 height=8 alt="\fun" src="zimg/fun-m.gif"> NAME </td></tr>
<tr> <td></td><td class="zed" colspan=2>store_msg: NAME <img width=14 height=8 alt="\fun" src="zimg/fun-m.gif"> MESSAGE</td></tr>
<tr><td width=10 height=1><img width=10 height=1 alt="\end{axdef}" src="zimg/clear.gif"></td></tr>
</table>
</div>

<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">StoreFieldC</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>Accept </td></tr>
<tr> <td></td><td class="zed" colspan=2>field!: NAME </td></tr>
<tr> <td></td><td class="zed" colspan=2>message!: MESSAGE</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>op = store_field </td></tr>
<tr> <td></td><td class="zed" colspan=2>field! = sname&nbsp;buffer </td></tr>
<tr> <td></td><td class="zed" colspan=2>message! = store_msg&nbsp;field!</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
The complex variants of <b>Select Field</b> (8.9.4, 187--188) are
handled by <var class="zed">SelectComplexFieldC</var>, which is similar to <var class="zed">EditSettingC</var>:
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">SelectComplexFieldC</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=7 height=10 alt="\Delta" src="zimg/Delta-m.gif"> Console1 </td></tr>
<tr> <td></td><td class="zed" colspan=2>Accept </td></tr>
<tr> <td></td><td class="zed" colspan=2>field!: FIELD </td></tr>
<tr> <td></td><td class="zed" colspan=2>dose!: VALUE</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>SelectFieldOp </td></tr>
<tr> <td></td><td class="zed" colspan=2>field! = new_field </td></tr>
<tr> <td></td><td class="zed" colspan=2>(<b>let</b> d == sval&nbsp;buffer <img width=7 height=7 alt="@" src="zimg/spot-m.gif"> d <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> valid&nbsp;dose <img width=8 height=7 alt="\land" src="zimg/land-m.gif"> dose! = d)</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
We have to make the operation total
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed">InvalidDose <img height=11 width=11 alt="\defs" src="zimg/defs-m.gif"> [&nbsp; Reprompt; <img width=7 height=10 alt="\Delta" src="zimg/Delta-m.gif"> Console1 | SelectFieldOp <img width=8 height=7 alt="\land" src="zimg/land-m.gif"> sval&nbsp;buffer <img width=7 height=11 align=absbottom alt="\notin" src="zimg/notin-m.gif"> valid&nbsp;dose &nbsp;]</td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed">ComplexOrInvalidField <img height=11 width=11 alt="\defs" src="zimg/defs-m.gif"> SelectComplexFieldC <img width=8 height=7 alt="\lor" src="zimg/lor-m.gif"> InvalidDose</td></tr>
</table>
</div>


<h4><a name="Logout and login">Logout and login</a></h4> 

<p class="informal">
The <b>Login</b> process (Fig. 2.6, 19) can be seen as editing the
value of <var class="zed">operator</var>.  Messages are logged at logout and login.  
<b>Logout</b> (2.5.2, 17 -- 18; 8.9.2, 184) is is similar to <var class="zed">SelectDisplay</var>
and <var class="zed">DialogOp</var>; it reads <var class="zed">Session</var> for the operator's ID in the logout
message. 
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td width=1 rowspan=99 bgcolor=black><img width=1 height=1 alt="\begin{axdef}" src="zimg/clear.gif"><br></td></tr>
<tr> <td></td><td class="zed" colspan=2>o_msg, lo_msg: OPERATOR <img width=14 height=8 alt="\fun" src="zimg/fun-m.gif"> MESSAGE</td></tr>
<tr><td width=10 height=1><img width=10 height=1 alt="\end{axdef}" src="zimg/clear.gif"></td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">Logout</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>Op </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=9 height=10 alt="\Xi" src="zimg/Xi-m.gif"> Session </td></tr>
<tr> <td></td><td class="zed" colspan=2>message!: MESSAGE</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>Setup </td></tr>
<tr> <td></td><td class="zed" colspan=2>input? = login </td></tr>
<tr> <td></td><td class="zed" colspan=2>display' = input? </td></tr>
<tr> <td></td><td class="zed" colspan=2>op' =  display' </td></tr>
<tr> <td></td><td class="zed" colspan=2>buffer' = empty </td></tr>
<tr> <td></td><td class="zed" colspan=2>message! = lo_msg&nbsp;operator </td></tr>
<tr> <td></td><td class="zed" colspan=2>Dialog' </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
A successful <b>Login</b> (2.5.2, 17 -- 20; 8.9.1, 183) occurs when a
user enters a valid operator identification.  The process of logging
back in is broken into two steps.  In the first step, the user types
their username into the buffer.  When the user types a terminator the
username is saved in another buffer; the <var class="zed">Console1</var> state is <var class="zed">Console</var>
with this buffer added (The password is also typed into
<var class="zed">buffer</var> so the <var class="zed">GetChar</var> operation can be used.). The console remains
logged out after this step.  This <var class="zed">EnterUsername</var> operation is similar
to <var class="zed">Accept</var> and <var class="zed">Continue</var>.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">Console2</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>Console </td></tr>
<tr> <td></td><td class="zed" colspan=2>username: STRING</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">EnterUsername</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=7 height=10 alt="\Delta" src="zimg/Delta-m.gif"> Console2 </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=7 height=10 alt="\Delta" src="zimg/Delta-m.gif"> Dialog </td></tr>
<tr> <td></td><td class="zed" colspan=2>EventUnlocked</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>op = login </td></tr>
<tr> <td></td><td class="zed" colspan=2>input? <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> terminator </td></tr>
<tr> <td></td><td class="zed" colspan=2>username' = buffer </td></tr>
<tr> <td></td><td class="zed" colspan=2>buffer' = empty </td></tr>
<tr> <td></td><td class="zed" colspan=2>op' = password </td></tr>
<tr> <td></td><td class="zed" colspan=2>  display' = display </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
In the second step, the user enters their password.  If their
username, password pair is found in operator database, the user is
logged in, the help screen is displayed, and the console becomes
available.  This <var class="zed">LoginC</var> operation is similar to <var class="zed">Accept</var> and
<var class="zed">SelectDisplay</var>.
</p>

<p class="informal">
The operator authorization file is modelled by Z global constants
<var class="zed">operators</var> and <var class="zed">physicists</var> (physicists are authorized to use the
equipment in its experiment mode, see 8.2, 170).  Values of <var class="zed">OPERATOR</var>
include the operator's password in addition to the operator's printed
name.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed"> USERNAME == STRING; PASSWORD == STRING </td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td width=1 rowspan=99 bgcolor=black><img width=1 height=1 alt="\begin{axdef}" src="zimg/clear.gif"><br></td></tr>
<tr> <td></td><td class="zed" colspan=2>soper: (USERNAME <img width=7 height=7 alt="\cross" src="zimg/cross-m.gif"> PASSWORD) <img width=14 height=8 alt="\fun" src="zimg/fun-m.gif"> OPERATOR </td></tr>
<tr><td width=10 height=1><img width=10 height=1 alt="\end{axdef}" src="zimg/clear.gif"></td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">LoginC</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=7 height=10 alt="\Delta" src="zimg/Delta-m.gif"> Console2 </td></tr>
<tr> <td></td><td class="zed" colspan=2>EventUnlocked </td></tr>
<tr> <td></td><td class="zed" colspan=2>operator!: OPERATOR </td></tr>
<tr> <td></td><td class="zed" colspan=2>message!: MESSAGE</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>op = password </td></tr>
<tr> <td></td><td class="zed" colspan=2>soper(username, buffer) <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> operators </td></tr>
<tr> <td></td><td class="zed" colspan=2>input? <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> terminator </td></tr>
<tr> <td></td><td class="zed" colspan=2>display' = help </td></tr>
<tr> <td></td><td class="zed" colspan=2>op' = display </td></tr>
<tr> <td></td><td class="zed" colspan=2>operator! = soper(username,buffer) </td></tr>
<tr> <td></td><td class="zed" colspan=2>message! = o_msg&nbsp;operator! </td></tr>
<tr> <td></td><td class="zed" colspan=2>Available'</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
If the username, password pair is not found in the authorization file,
the console remains logged out.  
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">Unauthorized</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=7 height=10 alt="\Delta" src="zimg/Delta-m.gif"> Console2 </td></tr>
<tr> <td></td><td class="zed" colspan=2>Reprompt </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>op = password </td></tr>
<tr> <td></td><td class="zed" colspan=2>soper(username,buffer) <img width=7 height=11 align=absbottom alt="\notin" src="zimg/notin-m.gif"> operators </td></tr>
<tr> <td></td><td class="zed" colspan=2>username' = username   </td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>


<p class="space"></p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed"> LoginOrUnauthorized <img height=11 width=11 alt="\defs" src="zimg/defs-m.gif"> LoginC <img width=8 height=7 alt="\lor" src="zimg/lor-m.gif"> Unauthorized </td></tr>
</table>
</div>

<p class="informal">
Users may cancel a login attempt while entering their username or
password.  The login process begins anew.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">CancelUsername</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=7 height=10 alt="\Delta" src="zimg/Delta-m.gif"> Console2 </td></tr>
<tr> <td></td><td class="zed" colspan=2><img width=7 height=10 alt="\Delta" src="zimg/Delta-m.gif"> Dialog </td></tr>
<tr> <td></td><td class="zed" colspan=2>EventUnlocked</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>op <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> { login, password } </td></tr>
<tr> <td></td><td class="zed" colspan=2>input?  = cancel </td></tr>
<tr> <td></td><td class="zed" colspan=2>op' = login </td></tr>
<tr> <td></td><td class="zed" colspan=2>buffer'  = empty </td></tr>
<tr> <td></td><td class="zed" colspan=2>username' = empty </td></tr>
<tr> <td></td><td class="zed" colspan=2>display' = display</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>


<h4><a name="Other operations">Other operations</a></h4>

<p class="informal">
Several operations not described in
<a href="ftp://ftp.radonc.washington.edu:/pub/cnts-reports/spec2">[jacky92]</a> are included for
development purposes (<var class="zed">Shutdown</var> will not be included in
production versions.).  They are always enabled.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed">Refresh <img height=11 width=11 alt="\defs" src="zimg/defs-m.gif"> [&nbsp; Event | input? = refresh &nbsp;]</td></tr>
<tr> <td class="zed"><img width=1 height=10 align=bottom alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td class="zed">Shutdown <img height=11 width=11 alt="\defs" src="zimg/defs-m.gif"> [&nbsp; Event | input? = shutdown &nbsp;]</td></tr>
</table>
</div>


<p class="informal">
This concludes our presention of the states and operations in the user
interface.
</p>

<h2><a name="Combining the subsystems">Combining the subsystems</a></h2> 

<p class="informal">
In this section we combine related operations from the <var class="zed">Console</var>,
<var class="zed">Session</var> and <var class="zed">Field</var> subsystems.  In cases where no data is
transferred between subsystems, we can simply conjoin the separate
operations:
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed"> ExptMode <img height=11 width=11 alt="\defs" src="zimg/defs-m.gif"> ExptModeC <img width=8 height=7 alt="\land" src="zimg/land-m.gif"> ExptModeS <img width=8 height=7 alt="\land" src="zimg/land-m.gif"> ExptModeF </td></tr>
</table>
</div>

<p class="informal">
Here the conjunction just expresses that the named operations in all
three subsystems are triggered by the <var class="zed">expt_mode</var> input at the
console.  In this report both <var class="zed">ExptModeC</var> and <var class="zed">ExptModeS</var> contain the
precondition <var class="zed">operator <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> physicists</var>, but this predicate only needs
to appear once; we include it in both schemas for clarity (In our
implementation, we observe the convention that preconditions of
combined operations are always tested in the <var class="zed">Console</var>
operations.  For example <var class="zed">operator <img width=7 height=7 alt="\in" src="zimg/in-m.gif"> physicists</var>
is tested by code in <tt>zconsole.c</tt>, not <tt>zsession.c</tt>.).
</p>

<p class="informal">
In other cases, data is transferred.  For example, in the <var class="zed">Override</var>
operation, the <var class="zed">item!</var> output from the <var class="zed">Console</var> subsystem is
consumed by the <var class="zed">item?</var> input in the <var class="zed">Field</var> subsystem (the <var class="zed">Session</var>
subsystem does not participate in this operation).  We wish to
express
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td><img alt="\begin{schema}{" src="zimg/clear.gif"></td>
     <td></td><td class="zed">Override</td>
     <td><img alt="}" src="zimg/clear.gif"></td></tr>
<tr> <td width=1 rowspan=99 bgcolor=black><br></td></tr>
<tr> <td width=10  height=1 bgcolor=black><img width=10 height=1 alt=" " src="zimg/black-10.gif"></td>
     <td height=1><img alt=" " src="zimg/clear.gif"></td>
     <td width=200 height=1 bgcolor=black><img width=200 height=1 alt=" " src="zimg/black-200.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>OverrideC </td></tr>
<tr> <td></td><td class="zed" colspan=2>OverrideF</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td height=1 bgcolor=black><img width=10 height=1 alt="\where" src="zimg/black-10.gif"></td>
      <td height=1 bgcolor=black><img width=15 height=1 alt=" " src="zimg/black-15.gif"></td>
      <td height=1><img width=75 height=1 alt=" " src="zimg/black-75.gif"></td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td></td><td class="zed" colspan=2>item! = item?</td></tr>
<tr> <td height=10><img alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td colspan=3 bgcolor=black><img width=300 height=1 alt="\end{schema}" src="zimg/black-300.gif"></td></tr>
</table>
</div>

<p class="informal">
This can be expressed more concisely using the Z <em>pipe</em> operator
<var class="zed">&gt;&gt;</var>, which has the effect of connecting corresponding input and
output variables (<a href="http://spivey.oriel.ox.ac.uk/~mike/zrm/">[spivey92]</a>, p. 78) (The Z pipe operator
also hides the piped variables.).
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed"> Override <img height=11 width=11 alt="\defs" src="zimg/defs-m.gif"> OverrideC &gt;&gt; OverrideF </td></tr>
</table>
</div>

<p class="informal">
In <var class="zed">Login</var>, the new operator name <var class="zed">operator!/operator?</var> is the piped variable.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed"> Login <img height=11 width=11 alt="\defs" src="zimg/defs-m.gif"> LoginC &gt;&gt; LoginS </td></tr>
</table>
</div>

<p class="informal">
In <var class="zed">EditSetting</var>, both the item name <var class="zed">item!/item?</var> and the
new setting value <var class="zed">value!/value?</var> are piped:
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0>
<tr> <td class="zed"> EditSetting <img height=11 width=11 alt="\defs" src="zimg/defs-m.gif"> EditSettingC &gt;&gt; EditSettingF </td></tr>
</table>
</div>

<p class="informal">
Sometimes the output from the <var class="zed">Console</var> subsystem is piped to inputs in
both the <var class="zed">Session</var> and <var class="zed">Field</var> subsystems.  In <var class="zed">StoreField</var>, the new
field name <var class="zed">field! / field?</var> is the piped variable:
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0> 
<tr> <td class="zed">StoreField <img height=11 width=11 alt="\defs" src="zimg/defs-m.gif"> StoreFieldC &gt;&gt; (StoreFieldS <img width=8 height=7 alt="\land" src="zimg/land-m.gif"> StoreFieldF)</td></tr>
</table>
</div>

<p class="informal">
Here the conjunction <var class="zed">StoreFieldS <img width=8 height=7 alt="\land" src="zimg/land-m.gif"> StoreFieldF</var> ensures that
<var class="zed">prescribed'</var> in <var class="zed">fields' = fields <img width=10 height=7 alt="\cup" src="zimg/cup-m.gif"> { field' <img height=9 width=10 alt="\mapsto" src="zimg/mapsto-m.gif"> prescribed' }</var> 
from <var class="zed">StoreFieldS</var> is the same as <var class="zed">prescribed'</var> in
<var class="zed">prescribed' = prescribed <img width=9 height=9 alt="\oplus" src="zimg/oplus-m.gif">  measured ...</var> from <var class="zed">StoreFieldF</var>.
</p>

<p class="informal">
In <var class="zed">SelectPatient</var>, the new patient name <var class="zed">patient!/patient?</var> is the
piped variable (<var class="zed">patient?</var> does not appear in <var class="zed">SelectPatientF</var>).
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0> 
<tr> <td class="zed">SelectPatient <img height=11 width=11 alt="\defs" src="zimg/defs-m.gif"> SelectPatientC &gt;&gt; (SelectPatientS <img width=8 height=7 alt="\land" src="zimg/land-m.gif"> SelectPatientF)</td></tr>
</table>
</div>

<p class="informal">
There are two variations of 
<var class="zed">SelectField</var>.  In both variants <var class="zed">field!/field?</var> is piped from 
the <var class="zed">SelectFieldC</var> variant to <var class="zed">SelectFieldS</var>.  In the complex variant,
<var class="zed">dose!/dose?</var> is piped from <var class="zed">SelectComplexFieldS</var> to <var class="zed">SelectComplexFieldF</var>.
</p>

<div class="zed">
<table border=0 cellpadding=0 cellspacing=0> 
<tr> <td class="zed">SelectSimpleField <img height=11 width=11 alt="\defs" src="zimg/defs-m.gif"> SelectSimpleFieldC &gt;&gt; (SelectFieldS <img width=8 height=7 alt="\land" src="zimg/land-m.gif"> SelectSimpleFieldF)</td></tr>
<tr> <td class="zed"><img width=1 height=10 align=bottom alt=" " src="zimg/clear.gif"></td></tr>
<tr> <td class="zed">SelectComplexField <img height=11 width=11 alt="\defs" src="zimg/defs-m.gif"> SelectComplexFieldC &gt;&gt; (SelectFieldS <img width=8 height=7 alt="\land" src="zimg/land-m.gif"> SelectComplexFieldF)</td></tr>
</table>
</div>

<p>
Back to <a href="#top">top</a>
</p>

<HR>

<ADDRESS>
<A HREF="http://staff.washington.edu/~jon/">Jonathan Jacky</A> /
<A HREF="http://www.radonc.washington.edu/">Department of Radiation Oncology</A>
 
Box 356043<br>
<a href="http://www.washington.edu/">University of Washington</a> /
Seattle, Washington 98195-6043 / USA<BR>
Tel (206) 598-4117 / Fax (206) 598-6218<BR>
<p>
E-mail: jon@u.washington.edu
</ADDRESS>

</body>
</html>
